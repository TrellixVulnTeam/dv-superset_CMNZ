{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _flatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/flat\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _debounce from \"lodash/debounce\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\n\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\nLOG_ACTIONS_MOUNT_EXPLORER,\nLOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string };\n\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth });\n\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = _debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}__signature__(useWindowSize, \"useState{[size, setSize](getWindowSize())}\\nuseEffect{}\");\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight ?\n  `${props.forcedHeight}px` :\n  `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width' };\n\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300 };\n\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n    props.form_data,\n    props.standalone ? URL_PARAMS.standalone.name : null,\n    false);\n\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n      'Failed at altering browser history',\n      payload,\n      title,\n      longUrl);\n\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && _Object$keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n      formData,\n      false,\n      props.timeout,\n      props.chart.id);\n\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (_sliceInstanceProperty(props)) {\n          props.actions.\n          saveSlice(props.form_data, {\n            action: 'overwrite',\n            slice_id: _sliceInstanceProperty(props).slice_id,\n            slice_name: _sliceInstanceProperty(props).slice_name,\n            add_to_dash: 'noSave',\n            goto_dash: false }).\n\n          then(({ data }) => {\n            window.location = _sliceInstanceProperty(data).slice_url;\n          });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {var _context;\n    const hasError = _someInstanceProperty(_context = _Object$values(props.controls)).call(_context,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n    getFormDataFromControls(props.controls),\n    props.chart.id);\n\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {var _context2;\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = _filterInstanceProperty(_context2 = _Object$keys(props.controls)).call(_context2,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      (key) => props.controls[key].renderTrigger);\n\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {var _context3;\n      const changedControlKeys = _filterInstanceProperty(_context3 = _Object$keys(props.controls)).call(_context3,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      return _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      (key) =>\n      !props.controls[key].renderTrigger &&\n      !props.controls[key].dontRefreshOnChange);\n\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {var _context4, _context5;\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = _filterInstanceProperty(_context4 = _Object$values(props.controls)).call(_context4,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = _mapInstanceProperty(controlsWithErrors).call(controlsWithErrors,\n    (control) => control.validationErrors);\n\n    const uniqueErrorMessages = [...new _Set(_flatInstanceProperty(errorMessages).call(errorMessages))];\n\n    const errors = _mapInstanceProperty(_context5 = _mapInstanceProperty(uniqueErrorMessages).call(uniqueErrorMessages,\n    (message) => {var _context6;\n      const matchingLabels = _mapInstanceProperty(_context6 = _filterInstanceProperty(controlsWithErrors).call(controlsWithErrors,\n      (control) => {var _control$validationEr;return (_control$validationEr = control.validationErrors) == null ? void 0 : _includesInstanceProperty(_control$validationEr).call(_control$validationEr, message);})).call(_context6,\n      (control) => control.label);\n      return [matchingLabels, message];\n    })).call(_context5,\n    ([labels, message]) =>\n    ___EmotionJSX(\"div\", { key: message, __self: this, __source: { fileName: _jsxFileName, lineNumber: 394, columnNumber: 9 } },\n    labels.length > 1 ? t('Controls labeled ') : t('Control labeled '),\n    ___EmotionJSX(\"strong\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 396, columnNumber: 11 } }, ` ${labels.join(', ')}`),\n    ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 397, columnNumber: 11 } }, \": \", message)));\n\n\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 403, columnNumber: 22 } }, errors);\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({\n        width: width,\n        height: height },\n      props, {\n        errorMessage: renderErrorMessage(),\n        refreshOverlayVisible: chartIsStale,\n        addHistory: addHistory,\n        onQuery: onQuery, __self: this, __source: { fileName: _jsxFileName, lineNumber: 410, columnNumber: 7 } })));\n\n\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(Styles, { id: \"explore-container\", height: height, __self: this, __source: { fileName: _jsxFileName, lineNumber: 436, columnNumber: 5 } },\n    ___EmotionJSX(Global, {\n      styles: css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `, __self: this, __source: { fileName: _jsxFileName, lineNumber: 437, columnNumber: 7 } }),\n\n    showingModal &&\n    ___EmotionJSX(SaveModal, {\n      onHide: toggleModal,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId, __self: this, __source: { fileName: _jsxFileName, lineNumber: 461, columnNumber: 9 } }),\n\n\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.dataSourceWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.dataSourceWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.dataSourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection', __self: this, __source: { fileName: _jsxFileName, lineNumber: 469, columnNumber: 7 } },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 484, columnNumber: 9 } },\n    ___EmotionJSX(\"span\", { className: \"horizont al-text\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 485, columnNumber: 11 } }, t('Dataset')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse, __self: this, __source: { fileName: _jsxFileName, lineNumber: 486, columnNumber: 11 } },\n\n    ___EmotionJSX(Icons.Expand, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 492, columnNumber: 13 } }))),\n\n\n\n    ___EmotionJSX(DataSourcePanel, {\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions, __self: this, __source: { fileName: _jsxFileName, lineNumber: 499, columnNumber: 9 } })),\n\n\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0, __self: this, __source: { fileName: _jsxFileName, lineNumber: 506, columnNumber: 9 } },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 513, columnNumber: 11 } },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 514, columnNumber: 13 } },\n    ___EmotionJSX(Icons.Collapse, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 515, columnNumber: 15 } }))),\n\n\n\n    ___EmotionJSX(Icons.DatasetPhysical, {\n      css: /*#__PURE__*/_css({ marginTop: theme.gridUnit * 2 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ExploreViewContainer;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9mcmFua2hlL3Byb2plY3RzL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9leHBsb3JlL2NvbXBvbmVudHMvRXhwbG9yZVZpZXdDb250YWluZXIuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQTBnQlkiLCJmaWxlIjoiL1VzZXJzL2ZyYW5raGUvcHJvamVjdHMvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9FeHBsb3JlVmlld0NvbnRhaW5lci5qc3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiBlc2xpbnQgY2FtZWxjYXNlOiAwICovXG5pbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBiaW5kQWN0aW9uQ3JlYXRvcnMgfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgc3R5bGVkLCB0LCBjc3MsIHVzZVRoZW1lIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgUmVzaXphYmxlIH0gZnJvbSAncmUtcmVzaXphYmxlJztcblxuaW1wb3J0IHsgdXNlUGx1Z2luQ29udGV4dCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0R5bmFtaWNQbHVnaW5zJztcbmltcG9ydCB7IEdsb2JhbCB9IGZyb20gJ0BlbW90aW9uL3JlYWN0JztcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICdzcmMvY29tcG9uZW50cy9Ub29sdGlwJztcbmltcG9ydCB7IHVzZVByZXZpb3VzIH0gZnJvbSAnc3JjL2NvbW1vbi9ob29rcy91c2VQcmV2aW91cyc7XG5pbXBvcnQgSWNvbnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvSWNvbnMnO1xuaW1wb3J0IHtcbiAgZ2V0RnJvbUxvY2FsU3RvcmFnZSxcbiAgc2V0SW5Mb2NhbFN0b3JhZ2UsXG59IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IFVSTF9QQVJBTVMgfSBmcm9tICdzcmMvY29uc3RhbnRzJztcbmltcG9ydCBjeCBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCAqIGFzIGNoYXJ0QWN0aW9ucyBmcm9tICdzcmMvY2hhcnQvY2hhcnRBY3Rpb24nO1xuaW1wb3J0IHsgZmV0Y2hEYXRhc291cmNlTWV0YWRhdGEgfSBmcm9tICdzcmMvZGFzaGJvYXJkL2FjdGlvbnMvZGF0YXNvdXJjZXMnO1xuaW1wb3J0IHsgY2hhcnRQcm9wU2hhcGUgfSBmcm9tICdzcmMvZGFzaGJvYXJkL3V0aWwvcHJvcFNoYXBlcyc7XG5pbXBvcnQgeyBtZXJnZUV4dHJhRm9ybURhdGEgfSBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvbmF0aXZlRmlsdGVycy91dGlscyc7XG5pbXBvcnQgRXhwbG9yZUNoYXJ0UGFuZWwgZnJvbSAnLi9FeHBsb3JlQ2hhcnRQYW5lbCc7XG5pbXBvcnQgQ29ubmVjdGVkQ29udHJvbFBhbmVsc0NvbnRhaW5lciBmcm9tICcuL0NvbnRyb2xQYW5lbHNDb250YWluZXInO1xuaW1wb3J0IFNhdmVNb2RhbCBmcm9tICcuL1NhdmVNb2RhbCc7XG5pbXBvcnQgUXVlcnlBbmRTYXZlQnRucyBmcm9tICcuL1F1ZXJ5QW5kU2F2ZUJ0bnMnO1xuaW1wb3J0IERhdGFTb3VyY2VQYW5lbCBmcm9tICcuL0RhdGFzb3VyY2VQYW5lbCc7XG5pbXBvcnQgeyBnZXRFeHBsb3JlTG9uZ1VybCB9IGZyb20gJy4uL2V4cGxvcmVVdGlscyc7XG5pbXBvcnQgeyBhcmVPYmplY3RzRXF1YWwgfSBmcm9tICcuLi8uLi9yZWR1eFV0aWxzJztcbmltcG9ydCB7IGdldEZvcm1EYXRhRnJvbUNvbnRyb2xzIH0gZnJvbSAnLi4vY29udHJvbFV0aWxzJztcbmltcG9ydCAqIGFzIGV4cGxvcmVBY3Rpb25zIGZyb20gJy4uL2FjdGlvbnMvZXhwbG9yZUFjdGlvbnMnO1xuaW1wb3J0ICogYXMgc2F2ZU1vZGFsQWN0aW9ucyBmcm9tICcuLi9hY3Rpb25zL3NhdmVNb2RhbEFjdGlvbnMnO1xuaW1wb3J0ICogYXMgbG9nQWN0aW9ucyBmcm9tICcuLi8uLi9sb2dnZXIvYWN0aW9ucyc7XG5pbXBvcnQge1xuICBMT0dfQUNUSU9OU19NT1VOVF9FWFBMT1JFUixcbiAgTE9HX0FDVElPTlNfQ0hBTkdFX0VYUExPUkVfQ09OVFJPTFMsXG59IGZyb20gJy4uLy4uL2xvZ2dlci9Mb2dVdGlscyc7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgLi4uRXhwbG9yZUNoYXJ0UGFuZWwucHJvcFR5cGVzLFxuICBoZWlnaHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHdpZHRoOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBhY3Rpb25zOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIGRhdGFzb3VyY2VfdHlwZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBkYXNoYm9hcmRJZDogUHJvcFR5cGVzLm51bWJlcixcbiAgaXNEYXRhc291cmNlTWV0YUxvYWRpbmc6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gIGNoYXJ0OiBjaGFydFByb3BTaGFwZS5pc1JlcXVpcmVkLFxuICBzbGljZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgc2xpY2VOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBjb250cm9sczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICBmb3JjZWRIZWlnaHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGZvcm1fZGF0YTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICBzdGFuZGFsb25lOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIHRpbWVvdXQ6IFByb3BUeXBlcy5udW1iZXIsXG4gIGltcHJlc3Npb25JZDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdml6VHlwZTogUHJvcFR5cGVzLnN0cmluZyxcbn07XG5cbmNvbnN0IFN0eWxlcyA9IHN0eWxlZC5kaXZgXG4gIGJhY2tncm91bmQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDV9O1xuICB0ZXh0LWFsaWduOiBsZWZ0O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gIGZsZXgtd3JhcDogbm93cmFwO1xuICBmbGV4LWJhc2lzOiAxMDB2aDtcbiAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgLmV4cGxvcmUtY29sdW1uIHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHggMDtcbiAgICBtYXgtaGVpZ2h0OiAxMDAlO1xuICB9XG4gIC5kYXRhLXNvdXJjZS1zZWxlY3Rpb24ge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDR9O1xuICAgIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4IDA7XG4gICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gIH1cbiAgLm1haW4tZXhwbG9yZS1jb250ZW50IHtcbiAgICBmbGV4OiAxO1xuICAgIG1pbi13aWR0aDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDEyOH1weDtcbiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgIC5wYW5lbCB7XG4gICAgICBtYXJnaW4tYm90dG9tOiAwO1xuICAgIH1cbiAgfVxuICAuY29udHJvbHMtY29sdW1uIHtcbiAgICBhbGlnbi1zZWxmOiBmbGV4LXN0YXJ0O1xuICAgIHBhZGRpbmc6IDA7XG4gIH1cbiAgLnRpdGxlLWNvbnRhaW5lciB7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBwYWRkaW5nOiAwICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAuaG9yaXpvbnRhbC10ZXh0IHtcbiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gICAgICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0MX07XG4gICAgICBmb250LXNpemU6ICR7KHsgdGhlbWUgfSkgPT4gNCAqIHRoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc307XG4gICAgfVxuICB9XG4gIC5uby1zaG93IHtcbiAgICBkaXNwbGF5OiBub25lO1xuICB9XG4gIC52ZXJ0aWNhbC10ZXh0IHtcbiAgICB3cml0aW5nLW1vZGU6IHZlcnRpY2FsLXJsO1xuICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkO1xuICB9XG4gIC5zaWRlYmFyIHtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NH07XG4gICAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAgd2lkdGg6ICR7KHsgdGhlbWUgfSkgPT4gOCAqIHRoZW1lLmdyaWRVbml0fXB4O1xuICB9XG4gIC5jYWxscGFzZS1pY29uID4gc3ZnIHtcbiAgICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMucHJpbWFyeS5iYXNlfTtcbiAgfVxuYDtcblxuY29uc3QgZ2V0V2luZG93U2l6ZSA9ICgpID0+ICh7XG4gIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0LFxuICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXG59KTtcblxuZnVuY3Rpb24gdXNlV2luZG93U2l6ZSh7IGRlbGF5TXMgPSAyNTAgfSA9IHt9KSB7XG4gIGNvbnN0IFtzaXplLCBzZXRTaXplXSA9IHVzZVN0YXRlKGdldFdpbmRvd1NpemUoKSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBvbldpbmRvd1Jlc2l6ZSA9IGRlYm91bmNlKCgpID0+IHNldFNpemUoZ2V0V2luZG93U2l6ZSgpKSwgZGVsYXlNcyk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTtcbiAgICByZXR1cm4gKCkgPT4gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiBzaXplO1xufVxuXG5mdW5jdGlvbiBFeHBsb3JlVmlld0NvbnRhaW5lcihwcm9wcykge1xuICBjb25zdCBkeW5hbWljUGx1Z2luQ29udGV4dCA9IHVzZVBsdWdpbkNvbnRleHQoKTtcbiAgY29uc3QgZHluYW1pY1BsdWdpbiA9IGR5bmFtaWNQbHVnaW5Db250ZXh0LmR5bmFtaWNQbHVnaW5zW3Byb3BzLnZpelR5cGVdO1xuICBjb25zdCBpc0R5bmFtaWNQbHVnaW5Mb2FkaW5nID0gZHluYW1pY1BsdWdpbiAmJiBkeW5hbWljUGx1Z2luLm1vdW50aW5nO1xuICBjb25zdCB3YXNEeW5hbWljUGx1Z2luTG9hZGluZyA9IHVzZVByZXZpb3VzKGlzRHluYW1pY1BsdWdpbkxvYWRpbmcpO1xuXG4gIGNvbnN0IHByZXZpb3VzQ29udHJvbHMgPSB1c2VQcmV2aW91cyhwcm9wcy5jb250cm9scyk7XG4gIGNvbnN0IHdpbmRvd1NpemUgPSB1c2VXaW5kb3dTaXplKCk7XG5cbiAgY29uc3QgW3Nob3dpbmdNb2RhbCwgc2V0U2hvd2luZ01vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2lzQ29sbGFwc2VkLCBzZXRJc0NvbGxhcHNlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICBjb25zdCB3aWR0aCA9IGAke3dpbmRvd1NpemUud2lkdGh9cHhgO1xuICBjb25zdCBuYXZIZWlnaHQgPSBwcm9wcy5zdGFuZGFsb25lID8gMCA6IDkwO1xuICBjb25zdCBoZWlnaHQgPSBwcm9wcy5mb3JjZWRIZWlnaHRcbiAgICA/IGAke3Byb3BzLmZvcmNlZEhlaWdodH1weGBcbiAgICA6IGAke3dpbmRvd1NpemUuaGVpZ2h0IC0gbmF2SGVpZ2h0fXB4YDtcblxuICBjb25zdCBzdG9yYWdlS2V5cyA9IHtcbiAgICBjb250cm9sc1dpZHRoOiAnY29udHJvbHNfd2lkdGgnLFxuICAgIGRhdGFTb3VyY2VXaWR0aDogJ2RhdGFzb3VyY2Vfd2lkdGgnLFxuICB9O1xuXG4gIGNvbnN0IGRlZmF1bHRTaWRlYmFyc1dpZHRoID0ge1xuICAgIGNvbnRyb2xzX3dpZHRoOiAzMjAsXG4gICAgZGF0YXNvdXJjZV93aWR0aDogMzAwLFxuICB9O1xuXG4gIGZ1bmN0aW9uIGFkZEhpc3RvcnkoeyBpc1JlcGxhY2UgPSBmYWxzZSwgdGl0bGUgfSA9IHt9KSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IHsgLi4ucHJvcHMuZm9ybV9kYXRhIH07XG4gICAgY29uc3QgbG9uZ1VybCA9IGdldEV4cGxvcmVMb25nVXJsKFxuICAgICAgcHJvcHMuZm9ybV9kYXRhLFxuICAgICAgcHJvcHMuc3RhbmRhbG9uZSA/IFVSTF9QQVJBTVMuc3RhbmRhbG9uZS5uYW1lIDogbnVsbCxcbiAgICAgIGZhbHNlLFxuICAgICk7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChpc1JlcGxhY2UpIHtcbiAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHBheWxvYWQsIHRpdGxlLCBsb25nVXJsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShwYXlsb2FkLCB0aXRsZSwgbG9uZ1VybCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ0ZhaWxlZCBhdCBhbHRlcmluZyBicm93c2VyIGhpc3RvcnknLFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgICB0aXRsZSxcbiAgICAgICAgbG9uZ1VybCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlUG9wc3RhdGUoKSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSB3aW5kb3cuaGlzdG9yeS5zdGF0ZTtcbiAgICBpZiAoZm9ybURhdGEgJiYgT2JqZWN0LmtleXMoZm9ybURhdGEpLmxlbmd0aCkge1xuICAgICAgcHJvcHMuYWN0aW9ucy5zZXRFeHBsb3JlQ29udHJvbHMoZm9ybURhdGEpO1xuICAgICAgcHJvcHMuYWN0aW9ucy5wb3N0Q2hhcnRGb3JtRGF0YShcbiAgICAgICAgZm9ybURhdGEsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBwcm9wcy50aW1lb3V0LFxuICAgICAgICBwcm9wcy5jaGFydC5pZCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25RdWVyeSgpIHtcbiAgICBwcm9wcy5hY3Rpb25zLnRyaWdnZXJRdWVyeSh0cnVlLCBwcm9wcy5jaGFydC5pZCk7XG4gICAgYWRkSGlzdG9yeSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlS2V5ZG93bihldmVudCkge1xuICAgIGNvbnN0IGNvbnRyb2xPckNvbW1hbmQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7XG4gICAgaWYgKGNvbnRyb2xPckNvbW1hbmQpIHtcbiAgICAgIGNvbnN0IGlzRW50ZXIgPSBldmVudC5rZXkgPT09ICdFbnRlcicgfHwgZXZlbnQua2V5Q29kZSA9PT0gMTM7XG4gICAgICBjb25zdCBpc1MgPSBldmVudC5rZXkgPT09ICdzJyB8fCBldmVudC5rZXlDb2RlID09PSA4MztcbiAgICAgIGlmIChpc0VudGVyKSB7XG4gICAgICAgIG9uUXVlcnkoKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNTKSB7XG4gICAgICAgIGlmIChwcm9wcy5zbGljZSkge1xuICAgICAgICAgIHByb3BzLmFjdGlvbnNcbiAgICAgICAgICAgIC5zYXZlU2xpY2UocHJvcHMuZm9ybV9kYXRhLCB7XG4gICAgICAgICAgICAgIGFjdGlvbjogJ292ZXJ3cml0ZScsXG4gICAgICAgICAgICAgIHNsaWNlX2lkOiBwcm9wcy5zbGljZS5zbGljZV9pZCxcbiAgICAgICAgICAgICAgc2xpY2VfbmFtZTogcHJvcHMuc2xpY2Uuc2xpY2VfbmFtZSxcbiAgICAgICAgICAgICAgYWRkX3RvX2Rhc2g6ICdub1NhdmUnLFxuICAgICAgICAgICAgICBnb3RvX2Rhc2g6IGZhbHNlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4ge1xuICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBkYXRhLnNsaWNlLnNsaWNlX3VybDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25TdG9wKCkge1xuICAgIGlmIChwcm9wcy5jaGFydCAmJiBwcm9wcy5jaGFydC5xdWVyeUNvbnRyb2xsZXIpIHtcbiAgICAgIHByb3BzLmNoYXJ0LnF1ZXJ5Q29udHJvbGxlci5hYm9ydCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZU1vZGFsKCkge1xuICAgIHNldFNob3dpbmdNb2RhbCghc2hvd2luZ01vZGFsKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZUNvbGxhcHNlKCkge1xuICAgIHNldElzQ29sbGFwc2VkKCFpc0NvbGxhcHNlZCk7XG4gIH1cblxuICAvLyBlZmZlY3QgdG8gcnVuIG9uIG1vdW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcHJvcHMuYWN0aW9ucy5sb2dFdmVudChMT0dfQUNUSU9OU19NT1VOVF9FWFBMT1JFUik7XG4gICAgYWRkSGlzdG9yeSh7IGlzUmVwbGFjZTogdHJ1ZSB9KTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBoYW5kbGVQb3BzdGF0ZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleWRvd24pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBoYW5kbGVQb3BzdGF0ZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5ZG93bik7XG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHdhc0R5bmFtaWNQbHVnaW5Mb2FkaW5nICYmICFpc0R5bmFtaWNQbHVnaW5Mb2FkaW5nKSB7XG4gICAgICAvLyByZWxvYWQgdGhlIGNvbnRyb2xzIG5vdyB0aGF0IHdlIGFjdHVhbGx5IGhhdmUgdGhlIGNvbnRyb2wgY29uZmlnXG4gICAgICBwcm9wcy5hY3Rpb25zLmR5bmFtaWNQbHVnaW5Db250cm9sc1JlYWR5KCk7XG4gICAgfVxuICB9LCBbaXNEeW5hbWljUGx1Z2luTG9hZGluZ10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFzRXJyb3IgPSBPYmplY3QudmFsdWVzKHByb3BzLmNvbnRyb2xzKS5zb21lKFxuICAgICAgY29udHJvbCA9PlxuICAgICAgICBjb250cm9sLnZhbGlkYXRpb25FcnJvcnMgJiYgY29udHJvbC52YWxpZGF0aW9uRXJyb3JzLmxlbmd0aCA+IDAsXG4gICAgKTtcbiAgICBpZiAoIWhhc0Vycm9yKSB7XG4gICAgICBwcm9wcy5hY3Rpb25zLnRyaWdnZXJRdWVyeSh0cnVlLCBwcm9wcy5jaGFydC5pZCk7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgY29uc3QgcmVSZW5kZXJDaGFydCA9ICgpID0+IHtcbiAgICBwcm9wcy5hY3Rpb25zLnVwZGF0ZVF1ZXJ5Rm9ybURhdGEoXG4gICAgICBnZXRGb3JtRGF0YUZyb21Db250cm9scyhwcm9wcy5jb250cm9scyksXG4gICAgICBwcm9wcy5jaGFydC5pZCxcbiAgICApO1xuICAgIHByb3BzLmFjdGlvbnMucmVuZGVyVHJpZ2dlcmVkKG5ldyBEYXRlKCkuZ2V0VGltZSgpLCBwcm9wcy5jaGFydC5pZCk7XG4gICAgYWRkSGlzdG9yeSgpO1xuICB9O1xuXG4gIC8vIGVmZmVjdCB0byBydW4gd2hlbiBjb250cm9scyBjaGFuZ2VcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAocHJldmlvdXNDb250cm9scykge1xuICAgICAgaWYgKFxuICAgICAgICBwcm9wcy5jb250cm9scy5kYXRhc291cmNlICYmXG4gICAgICAgIChwcmV2aW91c0NvbnRyb2xzLmRhdGFzb3VyY2UgPT0gbnVsbCB8fFxuICAgICAgICAgIHByb3BzLmNvbnRyb2xzLmRhdGFzb3VyY2UudmFsdWUgIT09IHByZXZpb3VzQ29udHJvbHMuZGF0YXNvdXJjZS52YWx1ZSlcbiAgICAgICkge1xuICAgICAgICAvLyB0aGlzIHNob3VsZCByZWFsbHkgYmUgaGFuZGxlZCBieSBhY3Rpb25zXG4gICAgICAgIGZldGNoRGF0YXNvdXJjZU1ldGFkYXRhKHByb3BzLmZvcm1fZGF0YS5kYXRhc291cmNlLCB0cnVlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2hhbmdlZENvbnRyb2xLZXlzID0gT2JqZWN0LmtleXMocHJvcHMuY29udHJvbHMpLmZpbHRlcihcbiAgICAgICAga2V5ID0+XG4gICAgICAgICAgdHlwZW9mIHByZXZpb3VzQ29udHJvbHNba2V5XSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAhYXJlT2JqZWN0c0VxdWFsKFxuICAgICAgICAgICAgcHJvcHMuY29udHJvbHNba2V5XS52YWx1ZSxcbiAgICAgICAgICAgIHByZXZpb3VzQ29udHJvbHNba2V5XS52YWx1ZSxcbiAgICAgICAgICApLFxuICAgICAgKTtcblxuICAgICAgLy8gdGhpcyBzaG91bGQgYWxzbyBiZSBoYW5kbGVkIGJ5IHRoZSBhY3Rpb25zIHRoYXQgYXJlIGFjdHVhbGx5IGNoYW5naW5nIHRoZSBjb250cm9sc1xuICAgICAgY29uc3QgaGFzRGlzcGxheUNvbnRyb2xDaGFuZ2VkID0gY2hhbmdlZENvbnRyb2xLZXlzLnNvbWUoXG4gICAgICAgIGtleSA9PiBwcm9wcy5jb250cm9sc1trZXldLnJlbmRlclRyaWdnZXIsXG4gICAgICApO1xuICAgICAgaWYgKGhhc0Rpc3BsYXlDb250cm9sQ2hhbmdlZCkge1xuICAgICAgICByZVJlbmRlckNoYXJ0KCk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbcHJvcHMuY29udHJvbHMsIHByb3BzLm93blN0YXRlXSk7XG5cbiAgY29uc3QgY2hhcnRJc1N0YWxlID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKHByZXZpb3VzQ29udHJvbHMpIHtcbiAgICAgIGNvbnN0IGNoYW5nZWRDb250cm9sS2V5cyA9IE9iamVjdC5rZXlzKHByb3BzLmNvbnRyb2xzKS5maWx0ZXIoXG4gICAgICAgIGtleSA9PlxuICAgICAgICAgIHR5cGVvZiBwcmV2aW91c0NvbnRyb2xzW2tleV0gIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgIWFyZU9iamVjdHNFcXVhbChcbiAgICAgICAgICAgIHByb3BzLmNvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgICBwcmV2aW91c0NvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgKSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBjaGFuZ2VkQ29udHJvbEtleXMuc29tZShcbiAgICAgICAga2V5ID0+XG4gICAgICAgICAgIXByb3BzLmNvbnRyb2xzW2tleV0ucmVuZGVyVHJpZ2dlciAmJlxuICAgICAgICAgICFwcm9wcy5jb250cm9sc1trZXldLmRvbnRSZWZyZXNoT25DaGFuZ2UsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sIFtwcmV2aW91c0NvbnRyb2xzLCBwcm9wcy5jb250cm9sc10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHByb3BzLm93blN0YXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIG9uUXVlcnkoKTtcbiAgICAgIHJlUmVuZGVyQ2hhcnQoKTtcbiAgICB9XG4gIH0sIFtwcm9wcy5vd25TdGF0ZV0pO1xuXG4gIGlmIChjaGFydElzU3RhbGUpIHtcbiAgICBwcm9wcy5hY3Rpb25zLmxvZ0V2ZW50KExPR19BQ1RJT05TX0NIQU5HRV9FWFBMT1JFX0NPTlRST0xTKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckVycm9yTWVzc2FnZSgpIHtcbiAgICAvLyBSZXR1cm5zIGFuIGVycm9yIG1lc3NhZ2UgYXMgYSBub2RlIGlmIGFueSBlcnJvcnMgYXJlIGluIHRoZSBzdG9yZVxuICAgIGNvbnN0IGNvbnRyb2xzV2l0aEVycm9ycyA9IE9iamVjdC52YWx1ZXMocHJvcHMuY29udHJvbHMpLmZpbHRlcihcbiAgICAgIGNvbnRyb2wgPT5cbiAgICAgICAgY29udHJvbC52YWxpZGF0aW9uRXJyb3JzICYmIGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwLFxuICAgICk7XG4gICAgaWYgKGNvbnRyb2xzV2l0aEVycm9ycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGVycm9yTWVzc2FnZXMgPSBjb250cm9sc1dpdGhFcnJvcnMubWFwKFxuICAgICAgY29udHJvbCA9PiBjb250cm9sLnZhbGlkYXRpb25FcnJvcnMsXG4gICAgKTtcbiAgICBjb25zdCB1bmlxdWVFcnJvck1lc3NhZ2VzID0gWy4uLm5ldyBTZXQoZXJyb3JNZXNzYWdlcy5mbGF0KCkpXTtcblxuICAgIGNvbnN0IGVycm9ycyA9IHVuaXF1ZUVycm9yTWVzc2FnZXNcbiAgICAgIC5tYXAobWVzc2FnZSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoaW5nTGFiZWxzID0gY29udHJvbHNXaXRoRXJyb3JzXG4gICAgICAgICAgLmZpbHRlcihjb250cm9sID0+IGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycz8uaW5jbHVkZXMobWVzc2FnZSkpXG4gICAgICAgICAgLm1hcChjb250cm9sID0+IGNvbnRyb2wubGFiZWwpO1xuICAgICAgICByZXR1cm4gW21hdGNoaW5nTGFiZWxzLCBtZXNzYWdlXTtcbiAgICAgIH0pXG4gICAgICAubWFwKChbbGFiZWxzLCBtZXNzYWdlXSkgPT4gKFxuICAgICAgICA8ZGl2IGtleT17bWVzc2FnZX0+XG4gICAgICAgICAge2xhYmVscy5sZW5ndGggPiAxID8gdCgnQ29udHJvbHMgbGFiZWxlZCAnKSA6IHQoJ0NvbnRyb2wgbGFiZWxlZCAnKX1cbiAgICAgICAgICA8c3Ryb25nPntgICR7bGFiZWxzLmpvaW4oJywgJyl9YH08L3N0cm9uZz5cbiAgICAgICAgICA8c3Bhbj46IHttZXNzYWdlfTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApKTtcblxuICAgIGxldCBlcnJvck1lc3NhZ2U7XG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICBlcnJvck1lc3NhZ2UgPSA8ZGl2IHN0eWxlPXt7IHRleHRBbGlnbjogJ2xlZnQnIH19PntlcnJvcnN9PC9kaXY+O1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JNZXNzYWdlO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyQ2hhcnRDb250YWluZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxFeHBsb3JlQ2hhcnRQYW5lbFxuICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIGVycm9yTWVzc2FnZT17cmVuZGVyRXJyb3JNZXNzYWdlKCl9XG4gICAgICAgIHJlZnJlc2hPdmVybGF5VmlzaWJsZT17Y2hhcnRJc1N0YWxlfVxuICAgICAgICBhZGRIaXN0b3J5PXthZGRIaXN0b3J5fVxuICAgICAgICBvblF1ZXJ5PXtvblF1ZXJ5fVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U2lkZWJhcldpZHRocyhrZXkpIHtcbiAgICByZXR1cm4gZ2V0RnJvbUxvY2FsU3RvcmFnZShrZXksIGRlZmF1bHRTaWRlYmFyc1dpZHRoW2tleV0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0U2lkZWJhcldpZHRocyhrZXksIGRpbWVuc2lvbikge1xuICAgIGNvbnN0IG5ld0RpbWVuc2lvbiA9IE51bWJlcihnZXRTaWRlYmFyV2lkdGhzKGtleSkpICsgZGltZW5zaW9uLndpZHRoO1xuICAgIHNldEluTG9jYWxTdG9yYWdlKGtleSwgbmV3RGltZW5zaW9uKTtcbiAgfVxuXG4gIGlmIChwcm9wcy5zdGFuZGFsb25lKSB7XG4gICAgcmV0dXJuIHJlbmRlckNoYXJ0Q29udGFpbmVyKCk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxTdHlsZXMgaWQ9XCJleHBsb3JlLWNvbnRhaW5lclwiIGhlaWdodD17aGVpZ2h0fT5cbiAgICAgIDxHbG9iYWxcbiAgICAgICAgc3R5bGVzPXtjc3NgXG4gICAgICAgICAgLm5hdmJhciB7XG4gICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBib2R5IHtcbiAgICAgICAgICAgIG1heC1oZWlnaHQ6IDEwMHZoO1xuICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgICAgICB9XG4gICAgICAgICAgI2FwcC1tZW51LFxuICAgICAgICAgICNhcHAge1xuICAgICAgICAgICAgZmxleDogMSAxIGF1dG87XG4gICAgICAgICAgfVxuICAgICAgICAgICNhcHAge1xuICAgICAgICAgICAgZmxleC1iYXNpczogMTAwJTtcbiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgICAgICBoZWlnaHQ6IDEwMHZoO1xuICAgICAgICAgIH1cbiAgICAgICAgICAjYXBwLW1lbnUge1xuICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7XG4gICAgICAgICAgfVxuICAgICAgICBgfVxuICAgICAgLz5cbiAgICAgIHtzaG93aW5nTW9kYWwgJiYgKFxuICAgICAgICA8U2F2ZU1vZGFsXG4gICAgICAgICAgb25IaWRlPXt0b2dnbGVNb2RhbH1cbiAgICAgICAgICBhY3Rpb25zPXtwcm9wcy5hY3Rpb25zfVxuICAgICAgICAgIGZvcm1fZGF0YT17cHJvcHMuZm9ybV9kYXRhfVxuICAgICAgICAgIHNsaWNlTmFtZT17cHJvcHMuc2xpY2VOYW1lfVxuICAgICAgICAgIGRhc2hib2FyZElkPXtwcm9wcy5kYXNoYm9hcmRJZH1cbiAgICAgICAgLz5cbiAgICAgICl9XG4gICAgICA8UmVzaXphYmxlXG4gICAgICAgIG9uUmVzaXplU3RvcD17KGV2dCwgZGlyZWN0aW9uLCByZWYsIGQpID0+XG4gICAgICAgICAgc2V0U2lkZWJhcldpZHRocyhzdG9yYWdlS2V5cy5kYXRhU291cmNlV2lkdGgsIGQpXG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdFNpemU9e3tcbiAgICAgICAgICB3aWR0aDogZ2V0U2lkZWJhcldpZHRocyhzdG9yYWdlS2V5cy5kYXRhU291cmNlV2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICB9fVxuICAgICAgICBtaW5XaWR0aD17ZGVmYXVsdFNpZGViYXJzV2lkdGhbc3RvcmFnZUtleXMuZGF0YVNvdXJjZVdpZHRoXX1cbiAgICAgICAgbWF4V2lkdGg9XCIzMyVcIlxuICAgICAgICBlbmFibGU9e3sgcmlnaHQ6IHRydWUgfX1cbiAgICAgICAgY2xhc3NOYW1lPXtcbiAgICAgICAgICBpc0NvbGxhcHNlZCA/ICduby1zaG93JyA6ICdleHBsb3JlLWNvbHVtbiBkYXRhLXNvdXJjZS1zZWxlY3Rpb24nXG4gICAgICAgIH1cbiAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0aXRsZS1jb250YWluZXJcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJob3Jpem9udCBhbC10ZXh0XCI+e3QoJ0RhdGFzZXQnKX08L3NwYW4+XG4gICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgIHJvbGU9XCJidXR0b25cIlxuICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICBjbGFzc05hbWU9XCJhY3Rpb24tYnV0dG9uXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RvZ2dsZUNvbGxhcHNlfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxJY29ucy5FeHBhbmRcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiY29sbGFwc2UtaWNvblwiXG4gICAgICAgICAgICAgIGljb25Db2xvcj17dGhlbWUuY29sb3JzLnByaW1hcnkuYmFzZX1cbiAgICAgICAgICAgICAgaWNvblNpemU9XCJsXCJcbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPERhdGFTb3VyY2VQYW5lbFxuICAgICAgICAgIGRhdGFzb3VyY2U9e3Byb3BzLmRhdGFzb3VyY2V9XG4gICAgICAgICAgY29udHJvbHM9e3Byb3BzLmNvbnRyb2xzfVxuICAgICAgICAgIGFjdGlvbnM9e3Byb3BzLmFjdGlvbnN9XG4gICAgICAgIC8+XG4gICAgICA8L1Jlc2l6YWJsZT5cbiAgICAgIHtpc0NvbGxhcHNlZCA/IChcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT1cInNpZGViYXJcIlxuICAgICAgICAgIG9uQ2xpY2s9e3RvZ2dsZUNvbGxhcHNlfVxuICAgICAgICAgIGRhdGEtdGVzdD1cIm9wZW4tZGF0YXNvdXJjZS10YWJcIlxuICAgICAgICAgIHJvbGU9XCJidXR0b25cIlxuICAgICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgICA+XG4gICAgICAgICAgPHNwYW4gcm9sZT1cImJ1dHRvblwiIHRhYkluZGV4PXswfSBjbGFzc05hbWU9XCJhY3Rpb24tYnV0dG9uXCI+XG4gICAgICAgICAgICA8VG9vbHRpcCB0aXRsZT17dCgnT3BlbiBEYXRhc291cmNlIHRhYicpfT5cbiAgICAgICAgICAgICAgPEljb25zLkNvbGxhcHNlXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiY29sbGFwc2UtaWNvblwiXG4gICAgICAgICAgICAgICAgaWNvbkNvbG9yPXt0aGVtZS5jb2xvcnMucHJpbWFyeS5iYXNlfVxuICAgICAgICAgICAgICAgIGljb25TaXplPVwibFwiXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxJY29ucy5EYXRhc2V0UGh5c2ljYWxcbiAgICAgICAgICAgIGNzcz17eyBtYXJnaW5Ub3A6IHRoZW1lLmdyaWRVbml0ICogMiB9fVxuICAgICAgICAgICAgaWNvblNpemU9XCJsXCJcbiAgICAgICAgICAgIGljb25Db2xvcj17dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSA6IG51bGx9XG4gICAgICA8UmVzaXphYmxlXG4gICAgICAgIG9uUmVzaXplU3RvcD17KGV2dCwgZGlyZWN0aW9uLCByZWYsIGQpID0+XG4gICAgICAgICAgc2V0U2lkZWJhcldpZHRocyhzdG9yYWdlS2V5cy5jb250cm9sc1dpZHRoLCBkKVxuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHRTaXplPXt7XG4gICAgICAgICAgd2lkdGg6IGdldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuY29udHJvbHNXaWR0aCksXG4gICAgICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICAgIH19XG4gICAgICAgIG1pbldpZHRoPXtkZWZhdWx0U2lkZWJhcnNXaWR0aFtzdG9yYWdlS2V5cy5jb250cm9sc1dpZHRoXX1cbiAgICAgICAgbWF4V2lkdGg9XCIzMyVcIlxuICAgICAgICBlbmFibGU9e3sgcmlnaHQ6IHRydWUgfX1cbiAgICAgICAgY2xhc3NOYW1lPVwiY29sLXNtLTMgZXhwbG9yZS1jb2x1bW4gY29udHJvbHMtY29sdW1uXCJcbiAgICAgID5cbiAgICAgICAgPFF1ZXJ5QW5kU2F2ZUJ0bnNcbiAgICAgICAgICBjYW5BZGQ9eyEhKHByb3BzLmNhbl9hZGQgfHwgcHJvcHMuY2FuX292ZXJ3cml0ZSl9XG4gICAgICAgICAgb25RdWVyeT17b25RdWVyeX1cbiAgICAgICAgICBvblNhdmU9e3RvZ2dsZU1vZGFsfVxuICAgICAgICAgIG9uU3RvcD17b25TdG9wfVxuICAgICAgICAgIGxvYWRpbmc9e3Byb3BzLmNoYXJ0LmNoYXJ0U3RhdHVzID09PSAnbG9hZGluZyd9XG4gICAgICAgICAgY2hhcnRJc1N0YWxlPXtjaGFydElzU3RhbGV9XG4gICAgICAgICAgZXJyb3JNZXNzYWdlPXtyZW5kZXJFcnJvck1lc3NhZ2UoKX1cbiAgICAgICAgICBkYXRhc291cmNlVHlwZT17cHJvcHMuZGF0YXNvdXJjZV90eXBlfVxuICAgICAgICAvPlxuICAgICAgICA8Q29ubmVjdGVkQ29udHJvbFBhbmVsc0NvbnRhaW5lclxuICAgICAgICAgIGFjdGlvbnM9e3Byb3BzLmFjdGlvbnN9XG4gICAgICAgICAgZm9ybV9kYXRhPXtwcm9wcy5mb3JtX2RhdGF9XG4gICAgICAgICAgY29udHJvbHM9e3Byb3BzLmNvbnRyb2xzfVxuICAgICAgICAgIGRhdGFzb3VyY2VfdHlwZT17cHJvcHMuZGF0YXNvdXJjZV90eXBlfVxuICAgICAgICAgIGlzRGF0YXNvdXJjZU1ldGFMb2FkaW5nPXtwcm9wcy5pc0RhdGFzb3VyY2VNZXRhTG9hZGluZ31cbiAgICAgICAgLz5cbiAgICAgIDwvUmVzaXphYmxlPlxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e2N4KFxuICAgICAgICAgICdtYWluLWV4cGxvcmUtY29udGVudCcsXG4gICAgICAgICAgaXNDb2xsYXBzZWQgPyAnY29sLXNtLTknIDogJ2NvbC1zbS03JyxcbiAgICAgICAgKX1cbiAgICAgID5cbiAgICAgICAge3JlbmRlckNoYXJ0Q29udGFpbmVyKCl9XG4gICAgICA8L2Rpdj5cbiAgICA8L1N0eWxlcz5cbiAgKTtcbn1cblxuRXhwbG9yZVZpZXdDb250YWluZXIucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuXG5mdW5jdGlvbiBtYXBTdGF0ZVRvUHJvcHMoc3RhdGUpIHtcbiAgY29uc3QgeyBleHBsb3JlLCBjaGFydHMsIGltcHJlc3Npb25JZCwgZGF0YU1hc2sgfSA9IHN0YXRlO1xuICBjb25zdCBmb3JtX2RhdGEgPSBnZXRGb3JtRGF0YUZyb21Db250cm9scyhleHBsb3JlLmNvbnRyb2xzKTtcbiAgZm9ybV9kYXRhLmV4dHJhX2Zvcm1fZGF0YSA9IG1lcmdlRXh0cmFGb3JtRGF0YShcbiAgICB7IC4uLmZvcm1fZGF0YS5leHRyYV9mb3JtX2RhdGEgfSxcbiAgICB7XG4gICAgICAuLi5kYXRhTWFza1tmb3JtX2RhdGEuc2xpY2VfaWQgPz8gMF0/Lm93blN0YXRlLCAvLyAwIC0gdW5zYXZlZCBjaGFydFxuICAgIH0sXG4gICk7XG4gIGNvbnN0IGNoYXJ0S2V5ID0gT2JqZWN0LmtleXMoY2hhcnRzKVswXTtcbiAgY29uc3QgY2hhcnQgPSBjaGFydHNbY2hhcnRLZXldO1xuICByZXR1cm4ge1xuICAgIGlzRGF0YXNvdXJjZU1ldGFMb2FkaW5nOiBleHBsb3JlLmlzRGF0YXNvdXJjZU1ldGFMb2FkaW5nLFxuICAgIGRhdGFzb3VyY2U6IGV4cGxvcmUuZGF0YXNvdXJjZSxcbiAgICBkYXRhc291cmNlX3R5cGU6IGV4cGxvcmUuZGF0YXNvdXJjZS50eXBlLFxuICAgIGRhdGFzb3VyY2VJZDogZXhwbG9yZS5kYXRhc291cmNlX2lkLFxuICAgIGRhc2hib2FyZElkOiBleHBsb3JlLmZvcm1fZGF0YSA/IGV4cGxvcmUuZm9ybV9kYXRhLmRhc2hib2FyZElkIDogdW5kZWZpbmVkLFxuICAgIGNvbnRyb2xzOiBleHBsb3JlLmNvbnRyb2xzLFxuICAgIGNhbl9vdmVyd3JpdGU6ICEhZXhwbG9yZS5jYW5fb3ZlcndyaXRlLFxuICAgIGNhbl9hZGQ6ICEhZXhwbG9yZS5jYW5fYWRkLFxuICAgIGNhbl9kb3dubG9hZDogISFleHBsb3JlLmNhbl9kb3dubG9hZCxcbiAgICBjb2x1bW5fZm9ybWF0czogZXhwbG9yZS5kYXRhc291cmNlXG4gICAgICA/IGV4cGxvcmUuZGF0YXNvdXJjZS5jb2x1bW5fZm9ybWF0c1xuICAgICAgOiBudWxsLFxuICAgIGNvbnRhaW5lcklkOiBleHBsb3JlLnNsaWNlXG4gICAgICA/IGBzbGljZS1jb250YWluZXItJHtleHBsb3JlLnNsaWNlLnNsaWNlX2lkfWBcbiAgICAgIDogJ3NsaWNlLWNvbnRhaW5lcicsXG4gICAgaXNTdGFycmVkOiBleHBsb3JlLmlzU3RhcnJlZCxcbiAgICBzbGljZTogZXhwbG9yZS5zbGljZSxcbiAgICBzbGljZU5hbWU6IGV4cGxvcmUuc2xpY2VOYW1lLFxuICAgIHRyaWdnZXJSZW5kZXI6IGV4cGxvcmUudHJpZ2dlclJlbmRlcixcbiAgICBmb3JtX2RhdGEsXG4gICAgdGFibGVfbmFtZTogZm9ybV9kYXRhLmRhdGFzb3VyY2VfbmFtZSxcbiAgICB2aXpUeXBlOiBmb3JtX2RhdGEudml6X3R5cGUsXG4gICAgc3RhbmRhbG9uZTogZXhwbG9yZS5zdGFuZGFsb25lLFxuICAgIGZvcmNlZEhlaWdodDogZXhwbG9yZS5mb3JjZWRfaGVpZ2h0LFxuICAgIGNoYXJ0LFxuICAgIHRpbWVvdXQ6IGV4cGxvcmUuY29tbW9uLmNvbmYuU1VQRVJTRVRfV0VCU0VSVkVSX1RJTUVPVVQsXG4gICAgb3duU3RhdGU6IGRhdGFNYXNrW2Zvcm1fZGF0YS5zbGljZV9pZCA/PyAwXT8ub3duU3RhdGUsIC8vIDAgLSB1bnNhdmVkIGNoYXJ0XG4gICAgaW1wcmVzc2lvbklkLFxuICAgIHVzZXJJZDogZXhwbG9yZS51c2VyX2lkLFxuICB9O1xufVxuXG5mdW5jdGlvbiBtYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpIHtcbiAgY29uc3QgYWN0aW9ucyA9IHtcbiAgICAuLi5leHBsb3JlQWN0aW9ucyxcbiAgICAuLi5zYXZlTW9kYWxBY3Rpb25zLFxuICAgIC4uLmNoYXJ0QWN0aW9ucyxcbiAgICAuLi5sb2dBY3Rpb25zLFxuICB9O1xuICByZXR1cm4ge1xuICAgIGFjdGlvbnM6IGJpbmRBY3Rpb25DcmVhdG9ycyhhY3Rpb25zLCBkaXNwYXRjaCksXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QoXG4gIG1hcFN0YXRlVG9Qcm9wcyxcbiAgbWFwRGlzcGF0Y2hUb1Byb3BzLFxuKShFeHBsb3JlVmlld0NvbnRhaW5lcik7XG4iXX0= */\"),\n      iconSize: \"l\",\n      iconColor: theme.colors.grayscale.base, __self: this, __source: { fileName: _jsxFileName, lineNumber: 522, columnNumber: 11 } })) :\n\n\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.controlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.controlsWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.controlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 529, columnNumber: 7 } },\n\n    ___EmotionJSX(QueryAndSaveBtns, {\n      canAdd: !!(props.can_add || props.can_overwrite),\n      onQuery: onQuery,\n      onSave: toggleModal,\n      onStop: onStop,\n      loading: props.chart.chartStatus === 'loading',\n      chartIsStale: chartIsStale,\n      errorMessage: renderErrorMessage(),\n      datasourceType: props.datasource_type, __self: this, __source: { fileName: _jsxFileName, lineNumber: 542, columnNumber: 9 } }),\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading, __self: this, __source: { fileName: _jsxFileName, lineNumber: 552, columnNumber: 9 } })),\n\n\n    ___EmotionJSX(\"div\", {\n      className: cx(\n      'main-explore-content',\n      isCollapsed ? 'col-sm-9' : 'col-sm-7'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 560, columnNumber: 7 } },\n\n\n    renderChartContainer())));\n\n\n\n}__signature__(ExploreViewContainer, \"usePluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseWindowSize{windowSize}\\nuseState{[showingModal, setShowingModal](false)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseTheme{theme}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseEffect{}\", () => [usePluginContext, usePrevious, usePrevious, useWindowSize, useTheme]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {var _dataMask, _form_data$slice_id, _dataMask2, _form_data$slice_id2;\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n  { ...form_data.extra_form_data },\n  {\n    ...((_dataMask = dataMask[(_form_data$slice_id = form_data.slice_id) != null ? _form_data$slice_id : 0]) == null ? void 0 : _dataMask.ownState) // 0 - unsaved chart\n  });\n\n  const chartKey = _Object$keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource ?\n    explore.datasource.column_formats :\n    null,\n    containerId: _sliceInstanceProperty(explore) ?\n    `slice-container-${_sliceInstanceProperty(explore).slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice: _sliceInstanceProperty(explore),\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: (_dataMask2 = dataMask[(_form_data$slice_id2 = form_data.slice_id) != null ? _form_data$slice_id2 : 0]) == null ? void 0 : _dataMask2.ownState, // 0 - unsaved chart\n    impressionId,\n    userId: explore.user_id };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions };\n\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreViewContainer);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(getWindowSize, \"getWindowSize\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(useWindowSize, \"useWindowSize\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx"],"names":["React","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","css","useTheme","Resizable","usePluginContext","Global","Tooltip","usePrevious","Icons","getFromLocalStorage","setInLocalStorage","URL_PARAMS","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","QueryAndSaveBtns","DataSourcePanel","getExploreLongUrl","areObjectsEqual","getFormDataFromControls","exploreActions","saveModalActions","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","propTypes","height","string","width","actions","object","isRequired","datasource_type","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","timeout","impressionId","vizType","Styles","div","theme","colors","grayscale","light5","light2","gridUnit","light4","light1","typography","sizes","s","primary","base","getWindowSize","window","innerHeight","innerWidth","useWindowSize","delayMs","size","setSize","onWindowResize","addEventListener","removeEventListener","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","dynamicPlugins","isDynamicPluginLoading","mounting","wasDynamicPluginLoading","previousControls","windowSize","showingModal","setShowingModal","isCollapsed","setIsCollapsed","navHeight","storageKeys","controlsWidth","dataSourceWidth","defaultSidebarsWidth","controls_width","datasource_width","addHistory","isReplace","title","payload","longUrl","name","history","replaceState","pushState","e","console","warn","handlePopstate","formData","state","length","setExploreControls","postChartFormData","id","onQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","key","keyCode","isS","saveSlice","action","slice_id","slice_name","add_to_dash","goto_dash","then","data","location","slice_url","onStop","queryController","abort","toggleModal","toggleCollapse","logEvent","document","dynamicPluginControlsReady","hasError","control","validationErrors","reRenderChart","updateQueryFormData","renderTriggered","Date","getTime","datasource","value","changedControlKeys","hasDisplayControlChanged","renderTrigger","ownState","chartIsStale","dontRefreshOnChange","undefined","renderErrorMessage","controlsWithErrors","errorMessages","uniqueErrorMessages","errors","message","matchingLabels","label","labels","join","errorMessage","textAlign","renderChartContainer","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","evt","direction","ref","d","right","marginTop","can_add","can_overwrite","chartStatus","mapStateToProps","explore","charts","dataMask","extra_form_data","chartKey","type","datasourceId","datasource_id","can_download","column_formats","containerId","isStarred","triggerRender","table_name","datasource_name","viz_type","forced_height","common","conf","SUPERSET_WEBSERVER_TIMEOUT","userId","user_id","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { Resizable } from 're-resizable';\n\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from '../../logger/LogUtils';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n};\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth,\n});\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight\n    ? `${props.forcedHeight}px`\n    : `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width',\n  };\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300,\n  };\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n      props.form_data,\n      props.standalone ? URL_PARAMS.standalone.name : null,\n      false,\n    );\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Failed at altering browser history',\n        payload,\n        title,\n        longUrl,\n      );\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        false,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions\n            .saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false,\n            })\n            .then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n      getFormDataFromControls(props.controls),\n      props.chart.id,\n    );\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n        key => props.controls[key].renderTrigger,\n      );\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = Object.values(props.controls).filter(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      control => control.validationErrors,\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages\n      .map(message => {\n        const matchingLabels = controlsWithErrors\n          .filter(control => control.validationErrors?.includes(message))\n          .map(control => control.label);\n        return [matchingLabels, message];\n      })\n      .map(([labels, message]) => (\n        <div key={message}>\n          {labels.length > 1 ? t('Controls labeled ') : t('Control labeled ')}\n          <strong>{` ${labels.join(', ')}`}</strong>\n          <span>: {message}</span>\n        </div>\n      ));\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        width={width}\n        height={height}\n        {...props}\n        errorMessage={renderErrorMessage()}\n        refreshOverlayVisible={chartIsStale}\n        addHistory={addHistory}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <Styles id=\"explore-container\" height={height}>\n      <Global\n        styles={css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `}\n      />\n      {showingModal && (\n        <SaveModal\n          onHide={toggleModal}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.dataSourceWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.dataSourceWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.dataSourceWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className={\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n        }\n      >\n        <div className=\"title-container\">\n          <span className=\"horizont al-text\">{t('Dataset')}</span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"action-button\"\n            onClick={toggleCollapse}\n          >\n            <Icons.Expand\n              className=\"collapse-icon\"\n              iconColor={theme.colors.primary.base}\n              iconSize=\"l\"\n            />\n          </span>\n        </div>\n        <DataSourcePanel\n          datasource={props.datasource}\n          controls={props.controls}\n          actions={props.actions}\n        />\n      </Resizable>\n      {isCollapsed ? (\n        <div\n          className=\"sidebar\"\n          onClick={toggleCollapse}\n          data-test=\"open-datasource-tab\"\n          role=\"button\"\n          tabIndex={0}\n        >\n          <span role=\"button\" tabIndex={0} className=\"action-button\">\n            <Tooltip title={t('Open Datasource tab')}>\n              <Icons.Collapse\n                className=\"collapse-icon\"\n                iconColor={theme.colors.primary.base}\n                iconSize=\"l\"\n              />\n            </Tooltip>\n          </span>\n          <Icons.DatasetPhysical\n            css={{ marginTop: theme.gridUnit * 2 }}\n            iconSize=\"l\"\n            iconColor={theme.colors.grayscale.base}\n          />\n        </div>\n      ) : null}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.controlsWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.controlsWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.controlsWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className=\"col-sm-3 explore-column controls-column\"\n      >\n        <QueryAndSaveBtns\n          canAdd={!!(props.can_add || props.can_overwrite)}\n          onQuery={onQuery}\n          onSave={toggleModal}\n          onStop={onStop}\n          loading={props.chart.chartStatus === 'loading'}\n          chartIsStale={chartIsStale}\n          errorMessage={renderErrorMessage()}\n          datasourceType={props.datasource_type}\n        />\n        <ConnectedControlPanelsContainer\n          actions={props.actions}\n          form_data={props.form_data}\n          controls={props.controls}\n          datasource_type={props.datasource_type}\n          isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n        />\n      </Resizable>\n      <div\n        className={cx(\n          'main-explore-content',\n          isCollapsed ? 'col-sm-9' : 'col-sm-7',\n        )}\n      >\n        {renderChartContainer()}\n      </div>\n    </Styles>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    },\n  );\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource\n      ? explore.datasource.column_formats\n      : null,\n    containerId: explore.slice\n      ? `slice-container-${explore.slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    impressionId,\n    userId: explore.user_id,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreViewContainer);\n"]},"metadata":{},"sourceType":"module"}