{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Map from \"@babel/runtime-corejs3/core-js-stable/map\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _reduceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reduce\";import _flatMapDeep from \"lodash/flatMapDeep\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport React from 'react';\nimport { ensureIsArray, GenericDataType } from '@superset-ui/core';\nconst FILTERS_FIELD_NAME = 'filters';\nexport const FILTER_SUPPORTED_TYPES = {\n  filter_time: [GenericDataType.TEMPORAL],\n  filter_timegrain: [GenericDataType.TEMPORAL],\n  filter_timecolumn: [GenericDataType.TEMPORAL],\n  filter_select: [\n  GenericDataType.STRING,\n  GenericDataType.NUMERIC,\n  GenericDataType.TEMPORAL],\n\n  filter_range: [GenericDataType.NUMERIC] };\n\nexport const useForceUpdate = () => {\n  const [, updateState] = React.useState({});\n  return React.useCallback(() => updateState({}), []);\n};__signature__(useForceUpdate, \"useState{[, updateState]({})}\\nuseCallback{}\");\nexport const setNativeFilterFieldValues = (form, filterId, values) => {\n  const formFilters = form.getFieldValue(FILTERS_FIELD_NAME) || {};\n  form.setFields([\n  {\n    name: FILTERS_FIELD_NAME,\n    value: {\n      ...formFilters,\n      [filterId]: {\n        ...formFilters[filterId],\n        ...values } } }]);\n\n\n\n\n};\nexport const getControlItems = (controlConfig = {}) => {var _flatMapDeep$reduce, _flatMapDeep2;return (_flatMapDeep$reduce = (_flatMapDeep2 = _flatMapDeep(controlConfig.controlPanelSections)) == null ? void 0 : _reduceInstanceProperty(_flatMapDeep2).call(_flatMapDeep2, (acc, { controlSetRows = [] }) => [\n  ...acc,\n  ..._flatMapDeep(controlSetRows)],\n  [])) != null ? _flatMapDeep$reduce : [];};\nexport const datasetToSelectOption = (item) => ({\n  value: item.id,\n  label: item.table_name });\n\n// TODO: add column_types field to DatasourceMeta\n// We return true if column_types is undefined or empty as a precaution against backend failing to return column_types\nexport const hasTemporalColumns = (dataset) => {\n  const columnTypes = ensureIsArray(dataset == null ? void 0 : dataset.column_types);\n  return columnTypes.length === 0 || _includesInstanceProperty(columnTypes).call(columnTypes, GenericDataType.TEMPORAL);\n};\nexport const doesColumnMatchFilterType = (filterType, column) => {var _FILTER_SUPPORTED_TYP;return !column.type_generic ||\n  !(filterType in FILTER_SUPPORTED_TYPES) || ((_FILTER_SUPPORTED_TYP =\n  FILTER_SUPPORTED_TYPES[filterType]) == null ? void 0 : _includesInstanceProperty(_FILTER_SUPPORTED_TYP).call(_FILTER_SUPPORTED_TYP, column.type_generic));};\nexport const mostUsedDataset = (datasets, charts) => {var _context, _datasets$mostUsedDat;\n  const map = new _Map();\n  let mostUsedDataset = '';\n  let maxCount = 0;\n  _forEachInstanceProperty(_context = _Object$values(charts)).call(_context, (chart) => {\n    const { formData } = chart;\n    if (formData) {\n      const { datasource } = formData;\n      const count = (map.get(datasource) || 0) + 1;\n      map.set(datasource, count);\n      if (count > maxCount) {\n        maxCount = count;\n        mostUsedDataset = datasource;\n      }\n    }\n  });\n  return (_datasets$mostUsedDat = datasets[mostUsedDataset]) == null ? void 0 : _datasets$mostUsedDat.id;\n};;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(FILTERS_FIELD_NAME, \"FILTERS_FIELD_NAME\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(FILTER_SUPPORTED_TYPES, \"FILTER_SUPPORTED_TYPES\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(useForceUpdate, \"useForceUpdate\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(setNativeFilterFieldValues, \"setNativeFilterFieldValues\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(getControlItems, \"getControlItems\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(datasetToSelectOption, \"datasetToSelectOption\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(hasTemporalColumns, \"hasTemporalColumns\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(doesColumnMatchFilterType, \"doesColumnMatchFilterType\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");reactHotLoader.register(mostUsedDataset, \"mostUsedDataset\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FiltersConfigModal/FiltersConfigForm/utils.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { flatMapDeep } from 'lodash';\nimport { FormInstance } from 'antd/lib/form';\nimport React from 'react';\nimport { CustomControlItem, DatasourceMeta } from '@superset-ui/chart-controls';\nimport { Column, ensureIsArray, GenericDataType } from '@superset-ui/core';\nimport { DatasourcesState, ChartsState } from 'src/dashboard/types';\n\nconst FILTERS_FIELD_NAME = 'filters';\n\nexport const FILTER_SUPPORTED_TYPES = {\n  filter_time: [GenericDataType.TEMPORAL],\n  filter_timegrain: [GenericDataType.TEMPORAL],\n  filter_timecolumn: [GenericDataType.TEMPORAL],\n  filter_select: [\n    GenericDataType.STRING,\n    GenericDataType.NUMERIC,\n    GenericDataType.TEMPORAL,\n  ],\n  filter_range: [GenericDataType.NUMERIC],\n};\n\nexport const useForceUpdate = () => {\n  const [, updateState] = React.useState({});\n  return React.useCallback(() => updateState({}), []);\n};\n\nexport const setNativeFilterFieldValues = (\n  form: FormInstance,\n  filterId: string,\n  values: object,\n) => {\n  const formFilters = form.getFieldValue(FILTERS_FIELD_NAME) || {};\n  form.setFields([\n    {\n      name: FILTERS_FIELD_NAME,\n      value: {\n        ...formFilters,\n        [filterId]: {\n          ...formFilters[filterId],\n          ...values,\n        },\n      },\n    },\n  ]);\n};\n\nexport const getControlItems = (\n  controlConfig: { [key: string]: any } = {},\n): CustomControlItem[] =>\n  (flatMapDeep(controlConfig.controlPanelSections)?.reduce(\n    (acc: any, { controlSetRows = [] }: any) => [\n      ...acc,\n      ...flatMapDeep(controlSetRows),\n    ],\n    [],\n  ) as CustomControlItem[]) ?? [];\n\ntype DatasetSelectValue = {\n  value: number;\n  label: string;\n};\n\nexport const datasetToSelectOption = (\n  item: DatasourceMeta & { table_name: string },\n): DatasetSelectValue => ({\n  value: item.id,\n  label: item.table_name,\n});\n\n// TODO: add column_types field to DatasourceMeta\n// We return true if column_types is undefined or empty as a precaution against backend failing to return column_types\nexport const hasTemporalColumns = (\n  dataset: DatasourceMeta & { column_types: GenericDataType[] },\n) => {\n  const columnTypes = ensureIsArray(dataset?.column_types);\n  return (\n    columnTypes.length === 0 || columnTypes.includes(GenericDataType.TEMPORAL)\n  );\n};\n\nexport const doesColumnMatchFilterType = (filterType: string, column: Column) =>\n  !column.type_generic ||\n  !(filterType in FILTER_SUPPORTED_TYPES) ||\n  FILTER_SUPPORTED_TYPES[filterType]?.includes(column.type_generic);\n\nexport const mostUsedDataset = (\n  datasets: DatasourcesState,\n  charts: ChartsState,\n) => {\n  const map = new Map<string, number>();\n  let mostUsedDataset = '';\n  let maxCount = 0;\n\n  Object.values(charts).forEach(chart => {\n    const { formData } = chart;\n    if (formData) {\n      const { datasource } = formData;\n      const count = (map.get(datasource) || 0) + 1;\n      map.set(datasource, count);\n\n      if (count > maxCount) {\n        maxCount = count;\n        mostUsedDataset = datasource;\n      }\n    }\n  });\n\n  return datasets[mostUsedDataset]?.id;\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}