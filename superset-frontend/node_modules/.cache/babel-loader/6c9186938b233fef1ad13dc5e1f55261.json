{"ast":null,"code":"import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _URL from \"@babel/runtime-corejs3/core-js-stable/url\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport moment from 'moment';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, CategoricalColorNamespace, t } from '@superset-ui/core';\nimport ButtonGroup from 'src/components/ButtonGroup';\n\nimport {\nLOG_ACTIONS_PERIODIC_RENDER_DASHBOARD,\nLOG_ACTIONS_FORCE_REFRESH_DASHBOARD,\nLOG_ACTIONS_TOGGLE_EDIT_DASHBOARD } from\n'src/logger/LogUtils';\n\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport EditableTitle from 'src/components/EditableTitle';\nimport FaveStar from 'src/components/FaveStar';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport HeaderActionsDropdown from 'src/dashboard/components/Header/HeaderActionsDropdown';\nimport PublishedStatus from 'src/dashboard/components/PublishedStatus';\nimport UndoRedoKeyListeners from 'src/dashboard/components/UndoRedoKeyListeners';\nimport PropertiesModal from 'src/dashboard/components/PropertiesModal';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport {\nUNDO_LIMIT,\nSAVE_TYPE_OVERWRITE,\nDASHBOARD_POSITION_DATA_LIMIT } from\n'src/dashboard/util/constants';\nimport setPeriodicRunner from 'src/dashboard/util/setPeriodicRunner';\nimport { options as PeriodicRefreshOptions } from 'src/dashboard/components/RefreshIntervalModal';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  addWarningToast: PropTypes.func.isRequired,\n  userId: PropTypes.number,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  dataMask: PropTypes.object.isRequired,\n  charts: PropTypes.objectOf(chartPropShape).isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  setColorSchemeAndUnsavedChanges: PropTypes.func.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  isPublished: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  onSave: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  fetchFaveStar: PropTypes.func.isRequired,\n  fetchCharts: PropTypes.func.isRequired,\n  saveFaveStar: PropTypes.func.isRequired,\n  savePublished: PropTypes.func.isRequired,\n  updateDashboardTitle: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  setEditMode: PropTypes.func.isRequired,\n  showBuilderPane: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  logEvent: PropTypes.func.isRequired,\n  hasUnsavedChanges: PropTypes.bool.isRequired,\n  maxUndoHistoryExceeded: PropTypes.bool.isRequired,\n  lastModifiedTime: PropTypes.number.isRequired,\n\n  // redux\n  onRefresh: PropTypes.func.isRequired,\n  onUndo: PropTypes.func.isRequired,\n  onRedo: PropTypes.func.isRequired,\n  undoLength: PropTypes.number.isRequired,\n  redoLength: PropTypes.number.isRequired,\n  setMaxUndoHistoryExceeded: PropTypes.func.isRequired,\n  maxUndoHistoryToast: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  dashboardInfoChanged: PropTypes.func.isRequired,\n  dashboardTitleChanged: PropTypes.func.isRequired };\n\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined };\n\n\n// Styled Components\nconst StyledDashboardHeader = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 ${({ theme }) => theme.gridUnit * 6}px;\n  border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n\n  .action-button > span {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  button,\n  .fave-unfave-icon {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .button-container {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    .action-button {\n      font-size: ${({ theme }) => theme.typography.sizes.xl}px;\n    }\n  }\n`;\n\nclass Header extends React.PureComponent {\n  static discardChanges() {\n    const url = new _URL(window.location.href);\n\n    url.searchParams.delete('edit');\n    window.location.assign(url);\n  }\n\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7, _context8, _context9;\n    super(props);\n    this.state = {\n      didNotifyMaxUndoHistoryToast: false,\n      emphasizeUndo: false,\n      showingPropertiesModal: false };\n\n\n    this.handleChangeText = _bindInstanceProperty(_context = this.handleChangeText).call(_context, this);\n    this.handleCtrlZ = _bindInstanceProperty(_context2 = this.handleCtrlZ).call(_context2, this);\n    this.handleCtrlY = _bindInstanceProperty(_context3 = this.handleCtrlY).call(_context3, this);\n    this.toggleEditMode = _bindInstanceProperty(_context4 = this.toggleEditMode).call(_context4, this);\n    this.forceRefresh = _bindInstanceProperty(_context5 = this.forceRefresh).call(_context5, this);\n    this.startPeriodicRender = _bindInstanceProperty(_context6 = this.startPeriodicRender).call(_context6, this);\n    this.overwriteDashboard = _bindInstanceProperty(_context7 = this.overwriteDashboard).call(_context7, this);\n    this.showPropertiesModal = _bindInstanceProperty(_context8 = this.showPropertiesModal).call(_context8, this);\n    this.hidePropertiesModal = _bindInstanceProperty(_context9 = this.hidePropertiesModal).call(_context9, this);\n  }\n\n  componentDidMount() {\n    const { refreshFrequency } = this.props;\n    this.startPeriodicRender(refreshFrequency * 1000);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n    UNDO_LIMIT - nextProps.undoLength <= 0 &&\n    !this.state.didNotifyMaxUndoHistoryToast)\n    {\n      this.setState(() => ({ didNotifyMaxUndoHistoryToast: true }));\n      this.props.maxUndoHistoryToast();\n    }\n    if (\n    nextProps.undoLength > UNDO_LIMIT &&\n    !this.props.maxUndoHistoryExceeded)\n    {\n      this.props.setMaxUndoHistoryExceeded();\n    }\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.ctrlYTimeout);\n    clearTimeout(this.ctrlZTimeout);\n  }\n\n  handleChangeText(nextText) {\n    const { updateDashboardTitle, onChange } = this.props;\n    if (nextText && this.props.dashboardTitle !== nextText) {\n      updateDashboardTitle(nextText);\n      onChange();\n    }\n  }\n\n  handleCtrlY() {\n    this.props.onRedo();\n    this.setState({ emphasizeRedo: true }, () => {\n      if (this.ctrlYTimeout) clearTimeout(this.ctrlYTimeout);\n      this.ctrlYTimeout = _setTimeout(() => {\n        this.setState({ emphasizeRedo: false });\n      }, 100);\n    });\n  }\n\n  handleCtrlZ() {\n    this.props.onUndo();\n    this.setState({ emphasizeUndo: true }, () => {\n      if (this.ctrlZTimeout) clearTimeout(this.ctrlZTimeout);\n      this.ctrlZTimeout = _setTimeout(() => {\n        this.setState({ emphasizeUndo: false });\n      }, 100);\n    });\n  }\n\n  forceRefresh() {\n    if (!this.props.isLoading) {\n      const chartList = _Object$keys(this.props.charts);\n      this.props.logEvent(LOG_ACTIONS_FORCE_REFRESH_DASHBOARD, {\n        force: true,\n        interval: 0,\n        chartCount: chartList.length });\n\n      return this.props.onRefresh(\n      chartList,\n      true,\n      0,\n      this.props.dashboardInfo.id);\n\n    }\n    return false;\n  }\n\n  startPeriodicRender(interval) {\n    let intervalMessage;\n    if (interval) {\n      const predefinedValue = _findInstanceProperty(PeriodicRefreshOptions).call(PeriodicRefreshOptions,\n      (option) => option.value === interval / 1000);\n\n      if (predefinedValue) {\n        intervalMessage = predefinedValue.label;\n      } else {\n        intervalMessage = moment.duration(interval, 'millisecond').humanize();\n      }\n    }\n\n    const periodicRender = () => {var _context10, _context11;\n      const { fetchCharts, logEvent, charts, dashboardInfo } = this.props;\n      const { metadata } = dashboardInfo;\n      const immune = metadata.timed_refresh_immune_slices || [];\n      const affectedCharts = _mapInstanceProperty(_context10 = _filterInstanceProperty(_context11 = _Object$values(charts)).call(_context11,\n      (chart) => _indexOfInstanceProperty(immune).call(immune, chart.id) === -1)).call(_context10,\n      (chart) => chart.id);\n\n      logEvent(LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD, {\n        interval,\n        chartCount: affectedCharts.length });\n\n      this.props.addWarningToast(\n      t(\n      `This dashboard is currently force refreshing; the next force refresh will be in %s.`,\n      intervalMessage));\n\n\n\n      return fetchCharts(\n      affectedCharts,\n      true,\n      interval * 0.2,\n      dashboardInfo.id);\n\n    };\n\n    this.refreshTimer = setPeriodicRunner({\n      interval,\n      periodicRender,\n      refreshTimer: this.refreshTimer });\n\n  }\n\n  toggleEditMode() {\n    this.props.logEvent(LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD, {\n      edit_mode: !this.props.editMode });\n\n    this.props.setEditMode(!this.props.editMode);\n  }\n\n  overwriteDashboard() {var _dashboardInfo$metada, _dashboardInfo$metada2;\n    const {\n      dashboardTitle,\n      layout: positions,\n      expandedSlices,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      dashboardInfo,\n      refreshFrequency: currentRefreshFrequency,\n      shouldPersistRefreshFrequency,\n      lastModifiedTime } =\n    this.props;\n\n    const scale = CategoricalColorNamespace.getScale(\n    colorScheme,\n    colorNamespace);\n\n\n    // use the colorScheme for default labels\n    let labelColors = colorScheme ? scale.getColorMap() : {};\n    // but allow metadata to overwrite if it exists\n    // eslint-disable-next-line camelcase\n    const metadataLabelColors = (_dashboardInfo$metada = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada.label_colors;\n    if (metadataLabelColors) {\n      labelColors = { ...labelColors, ...metadataLabelColors };\n    }\n\n    // check refresh frequency is for current session or persist\n    const refreshFrequency = shouldPersistRefreshFrequency ?\n    currentRefreshFrequency : (_dashboardInfo$metada2 =\n    dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada2.refresh_frequency; // eslint-disable-line camelcase\n\n    const data = {\n      positions,\n      expanded_slices: expandedSlices,\n      css: customCss,\n      color_namespace: colorNamespace,\n      color_scheme: colorScheme,\n      label_colors: labelColors,\n      dashboard_title: dashboardTitle,\n      refresh_frequency: refreshFrequency,\n      last_modified_time: lastModifiedTime };\n\n\n    // make sure positions data less than DB storage limitation:\n    const positionJSONLength = safeStringify(positions).length;\n    const limit =\n    dashboardInfo.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT ||\n    DASHBOARD_POSITION_DATA_LIMIT;\n    if (positionJSONLength >= limit) {\n      this.props.addDangerToast(\n      t(\n      'Your dashboard is too large. Please reduce its size before saving it.'));\n\n\n    } else {\n      if (positionJSONLength >= limit * 0.9) {\n        this.props.addWarningToast('Your dashboard is near the size limit.');\n      }\n\n      this.props.onSave(data, dashboardInfo.id, SAVE_TYPE_OVERWRITE);\n    }\n  }\n\n  showPropertiesModal() {\n    this.setState({ showingPropertiesModal: true });\n  }\n\n  hidePropertiesModal() {\n    this.setState({ showingPropertiesModal: false });\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      layout,\n      expandedSlices,\n      customCss,\n      colorNamespace,\n      dataMask,\n      setColorSchemeAndUnsavedChanges,\n      colorScheme,\n      onUndo,\n      onRedo,\n      undoLength,\n      redoLength,\n      onChange,\n      onSave,\n      updateCss,\n      editMode,\n      isPublished,\n      userId,\n      dashboardInfo,\n      hasUnsavedChanges,\n      isLoading,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      setRefreshFrequency,\n      lastModifiedTime } =\n    this.props;\n\n    const userCanEdit = dashboardInfo.dash_edit_perm;\n    const userCanShare = dashboardInfo.dash_share_perm;\n    const userCanSaveAs = dashboardInfo.dash_save_perm;\n    const refreshLimit =\n    dashboardInfo.common.conf.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT;\n    const refreshWarning =\n    dashboardInfo.common.conf.\n    SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;\n\n    return (\n      ___EmotionJSX(StyledDashboardHeader, {\n        className: \"dashboard-header\",\n        \"data-test\": \"dashboard-header\",\n        \"data-test-id\": `${dashboardInfo.id}`, __self: this, __source: { fileName: _jsxFileName, lineNumber: 396, columnNumber: 7 } },\n\n      ___EmotionJSX(\"div\", { className: \"dashboard-component-header header-large\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 401, columnNumber: 9 } },\n      ___EmotionJSX(EditableTitle, {\n        title: dashboardTitle,\n        canEdit: userCanEdit && editMode,\n        onSaveTitle: this.handleChangeText,\n        showTooltip: false, __self: this, __source: { fileName: _jsxFileName, lineNumber: 402, columnNumber: 11 } }),\n\n      ___EmotionJSX(PublishedStatus, {\n        dashboardId: dashboardInfo.id,\n        isPublished: isPublished,\n        savePublished: this.props.savePublished,\n        canEdit: userCanEdit,\n        canSave: userCanSaveAs, __self: this, __source: { fileName: _jsxFileName, lineNumber: 408, columnNumber: 11 } }),\n\n      userId &&\n      ___EmotionJSX(FaveStar, {\n        itemId: dashboardInfo.id,\n        fetchFaveStar: this.props.fetchFaveStar,\n        saveFaveStar: this.props.saveFaveStar,\n        isStarred: this.props.isStarred,\n        showTooltip: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 416, columnNumber: 13 } })),\n\n\n\n\n      ___EmotionJSX(\"div\", { className: \"button-container\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 426, columnNumber: 9 } },\n      userCanSaveAs &&\n      ___EmotionJSX(\"div\", {\n        className: \"button-container\",\n        \"data-test\": \"dashboard-edit-actions\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 428, columnNumber: 13 } },\n\n      editMode &&\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(ButtonGroup, { className: \"m-r-5\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 434, columnNumber: 19 } },\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        onClick: onUndo,\n        disabled: undoLength < 1,\n        buttonStyle:\n        this.state.emphasizeUndo ? 'primary' : undefined, __self: this, __source: { fileName: _jsxFileName, lineNumber: 435, columnNumber: 21 } },\n\n\n      ___EmotionJSX(\"i\", {\n        title: \"Undo\",\n        className: \"undo-action fa fa-reply\",\n        \"data-test\": \"undo-action\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 443, columnNumber: 23 } }), \"\\xA0\"),\n\n\n\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        onClick: onRedo,\n        disabled: redoLength < 1,\n        buttonStyle:\n        this.state.emphasizeRedo ? 'primary' : undefined, __self: this, __source: { fileName: _jsxFileName, lineNumber: 450, columnNumber: 21 } }, \"\\xA0\",\n\n\n\n      ___EmotionJSX(\"i\", { title: \"Redo\", className: \"redo-action fa fa-share\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 459, columnNumber: 23 } }))),\n\n\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        className: \"m-r-5\",\n        onClick: this.constructor.discardChanges,\n        buttonStyle: \"default\",\n        \"data-test\": \"discard-changes-button\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 462, columnNumber: 19 } },\n\n      t('Discard changes')),\n\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        disabled: !hasUnsavedChanges,\n        buttonStyle: \"primary\",\n        onClick: this.overwriteDashboard,\n        \"data-test\": \"header-save-button\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 471, columnNumber: 19 } },\n\n      t('Save')))),\n\n\n\n\n\n      editMode &&\n      ___EmotionJSX(UndoRedoKeyListeners, {\n        onUndo: this.handleCtrlZ,\n        onRedo: this.handleCtrlY, __self: this, __source: { fileName: _jsxFileName, lineNumber: 485, columnNumber: 13 } }),\n\n\n\n      !editMode && userCanEdit &&\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"span\", {\n        role: \"button\",\n        title: t('Edit dashboard'),\n        tabIndex: 0,\n        className: \"action-button\",\n        onClick: this.toggleEditMode, __self: this, __source: { fileName: _jsxFileName, lineNumber: 493, columnNumber: 15 } },\n\n      ___EmotionJSX(Icons.EditAlt, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 500, columnNumber: 17 } }))),\n\n\n\n\n      this.state.showingPropertiesModal &&\n      ___EmotionJSX(PropertiesModal, {\n        dashboardId: dashboardInfo.id,\n        show: this.state.showingPropertiesModal,\n        onHide: this.hidePropertiesModal,\n        colorScheme: this.props.colorScheme,\n        onSubmit: (updates) => {\n          const {\n            dashboardInfoChanged,\n            dashboardTitleChanged } =\n          this.props;\n          dashboardInfoChanged({\n            slug: updates.slug,\n            metadata: JSON.parse(updates.jsonMetadata) });\n\n          setColorSchemeAndUnsavedChanges(updates.colorScheme);\n          dashboardTitleChanged(updates.title);\n          if (updates.slug) {\n            window.history.pushState(\n            { event: 'dashboard_properties_changed' },\n            '',\n            `/superset/dashboard/${updates.slug}/`);\n\n          }\n        }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 506, columnNumber: 13 } }),\n\n\n\n      ___EmotionJSX(HeaderActionsDropdown, {\n        addSuccessToast: this.props.addSuccessToast,\n        addDangerToast: this.props.addDangerToast,\n        dashboardId: dashboardInfo.id,\n        dashboardTitle: dashboardTitle,\n        dashboardInfo: dashboardInfo,\n        dataMask: dataMask,\n        layout: layout,\n        expandedSlices: expandedSlices,\n        customCss: customCss,\n        colorNamespace: colorNamespace,\n        colorScheme: colorScheme,\n        onSave: onSave,\n        onChange: onChange,\n        forceRefreshAllCharts: this.forceRefresh,\n        startPeriodicRender: this.startPeriodicRender,\n        refreshFrequency: refreshFrequency,\n        shouldPersistRefreshFrequency: shouldPersistRefreshFrequency,\n        setRefreshFrequency: setRefreshFrequency,\n        updateCss: updateCss,\n        editMode: editMode,\n        hasUnsavedChanges: hasUnsavedChanges,\n        userCanEdit: userCanEdit,\n        userCanShare: userCanShare,\n        userCanSave: userCanSaveAs,\n        isLoading: isLoading,\n        showPropertiesModal: this.showPropertiesModal,\n        refreshLimit: refreshLimit,\n        refreshWarning: refreshWarning,\n        lastModifiedTime: lastModifiedTime, __self: this, __source: { fileName: _jsxFileName, lineNumber: 533, columnNumber: 11 } }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nHeader.propTypes = propTypes;\nHeader.defaultProps = defaultProps;const _default =\n\nHeader;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\");reactHotLoader.register(StyledDashboardHeader, \"StyledDashboardHeader\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\");reactHotLoader.register(Header, \"Header\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/Header/index.jsx"],"names":["moment","React","PropTypes","styled","CategoricalColorNamespace","t","ButtonGroup","LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD","LOG_ACTIONS_FORCE_REFRESH_DASHBOARD","LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD","Icons","Button","EditableTitle","FaveStar","safeStringify","HeaderActionsDropdown","PublishedStatus","UndoRedoKeyListeners","PropertiesModal","chartPropShape","UNDO_LIMIT","SAVE_TYPE_OVERWRITE","DASHBOARD_POSITION_DATA_LIMIT","setPeriodicRunner","options","PeriodicRefreshOptions","propTypes","addSuccessToast","func","isRequired","addDangerToast","addWarningToast","userId","number","dashboardInfo","object","dashboardTitle","string","dataMask","charts","objectOf","layout","expandedSlices","customCss","colorNamespace","colorScheme","setColorSchemeAndUnsavedChanges","isStarred","bool","isPublished","isLoading","onSave","onChange","fetchFaveStar","fetchCharts","saveFaveStar","savePublished","updateDashboardTitle","editMode","setEditMode","showBuilderPane","updateCss","logEvent","hasUnsavedChanges","maxUndoHistoryExceeded","lastModifiedTime","onRefresh","onUndo","onRedo","undoLength","redoLength","setMaxUndoHistoryExceeded","maxUndoHistoryToast","refreshFrequency","shouldPersistRefreshFrequency","setRefreshFrequency","dashboardInfoChanged","dashboardTitleChanged","defaultProps","undefined","StyledDashboardHeader","div","theme","colors","grayscale","light5","gridUnit","light2","base","typography","sizes","xl","Header","PureComponent","discardChanges","url","window","location","href","searchParams","delete","assign","constructor","props","state","didNotifyMaxUndoHistoryToast","emphasizeUndo","showingPropertiesModal","handleChangeText","handleCtrlZ","handleCtrlY","toggleEditMode","forceRefresh","startPeriodicRender","overwriteDashboard","showPropertiesModal","hidePropertiesModal","componentDidMount","UNSAFE_componentWillReceiveProps","nextProps","setState","componentWillUnmount","clearTimeout","ctrlYTimeout","ctrlZTimeout","nextText","emphasizeRedo","chartList","force","interval","chartCount","length","id","intervalMessage","predefinedValue","option","value","label","duration","humanize","periodicRender","metadata","immune","timed_refresh_immune_slices","affectedCharts","chart","refreshTimer","edit_mode","positions","currentRefreshFrequency","scale","getScale","labelColors","getColorMap","metadataLabelColors","label_colors","refresh_frequency","data","expanded_slices","css","color_namespace","color_scheme","dashboard_title","last_modified_time","positionJSONLength","limit","common","conf","SUPERSET_DASHBOARD_POSITION_DATA_LIMIT","render","userCanEdit","dash_edit_perm","userCanShare","dash_share_perm","userCanSaveAs","dash_save_perm","refreshLimit","SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT","refreshWarning","SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE","updates","slug","JSON","parse","jsonMetadata","title","history","pushState","event"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport moment from 'moment';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, CategoricalColorNamespace, t } from '@superset-ui/core';\nimport ButtonGroup from 'src/components/ButtonGroup';\n\nimport {\n  LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD,\n  LOG_ACTIONS_FORCE_REFRESH_DASHBOARD,\n  LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD,\n} from 'src/logger/LogUtils';\n\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport EditableTitle from 'src/components/EditableTitle';\nimport FaveStar from 'src/components/FaveStar';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport HeaderActionsDropdown from 'src/dashboard/components/Header/HeaderActionsDropdown';\nimport PublishedStatus from 'src/dashboard/components/PublishedStatus';\nimport UndoRedoKeyListeners from 'src/dashboard/components/UndoRedoKeyListeners';\nimport PropertiesModal from 'src/dashboard/components/PropertiesModal';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport {\n  UNDO_LIMIT,\n  SAVE_TYPE_OVERWRITE,\n  DASHBOARD_POSITION_DATA_LIMIT,\n} from 'src/dashboard/util/constants';\nimport setPeriodicRunner from 'src/dashboard/util/setPeriodicRunner';\nimport { options as PeriodicRefreshOptions } from 'src/dashboard/components/RefreshIntervalModal';\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  addWarningToast: PropTypes.func.isRequired,\n  userId: PropTypes.number,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  dataMask: PropTypes.object.isRequired,\n  charts: PropTypes.objectOf(chartPropShape).isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  setColorSchemeAndUnsavedChanges: PropTypes.func.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  isPublished: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  onSave: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  fetchFaveStar: PropTypes.func.isRequired,\n  fetchCharts: PropTypes.func.isRequired,\n  saveFaveStar: PropTypes.func.isRequired,\n  savePublished: PropTypes.func.isRequired,\n  updateDashboardTitle: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  setEditMode: PropTypes.func.isRequired,\n  showBuilderPane: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  logEvent: PropTypes.func.isRequired,\n  hasUnsavedChanges: PropTypes.bool.isRequired,\n  maxUndoHistoryExceeded: PropTypes.bool.isRequired,\n  lastModifiedTime: PropTypes.number.isRequired,\n\n  // redux\n  onRefresh: PropTypes.func.isRequired,\n  onUndo: PropTypes.func.isRequired,\n  onRedo: PropTypes.func.isRequired,\n  undoLength: PropTypes.number.isRequired,\n  redoLength: PropTypes.number.isRequired,\n  setMaxUndoHistoryExceeded: PropTypes.func.isRequired,\n  maxUndoHistoryToast: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  dashboardInfoChanged: PropTypes.func.isRequired,\n  dashboardTitleChanged: PropTypes.func.isRequired,\n};\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n};\n\n// Styled Components\nconst StyledDashboardHeader = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 ${({ theme }) => theme.gridUnit * 6}px;\n  border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n\n  .action-button > span {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  button,\n  .fave-unfave-icon {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .button-container {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    .action-button {\n      font-size: ${({ theme }) => theme.typography.sizes.xl}px;\n    }\n  }\n`;\n\nclass Header extends React.PureComponent {\n  static discardChanges() {\n    const url = new URL(window.location.href);\n\n    url.searchParams.delete('edit');\n    window.location.assign(url);\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      didNotifyMaxUndoHistoryToast: false,\n      emphasizeUndo: false,\n      showingPropertiesModal: false,\n    };\n\n    this.handleChangeText = this.handleChangeText.bind(this);\n    this.handleCtrlZ = this.handleCtrlZ.bind(this);\n    this.handleCtrlY = this.handleCtrlY.bind(this);\n    this.toggleEditMode = this.toggleEditMode.bind(this);\n    this.forceRefresh = this.forceRefresh.bind(this);\n    this.startPeriodicRender = this.startPeriodicRender.bind(this);\n    this.overwriteDashboard = this.overwriteDashboard.bind(this);\n    this.showPropertiesModal = this.showPropertiesModal.bind(this);\n    this.hidePropertiesModal = this.hidePropertiesModal.bind(this);\n  }\n\n  componentDidMount() {\n    const { refreshFrequency } = this.props;\n    this.startPeriodicRender(refreshFrequency * 1000);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      UNDO_LIMIT - nextProps.undoLength <= 0 &&\n      !this.state.didNotifyMaxUndoHistoryToast\n    ) {\n      this.setState(() => ({ didNotifyMaxUndoHistoryToast: true }));\n      this.props.maxUndoHistoryToast();\n    }\n    if (\n      nextProps.undoLength > UNDO_LIMIT &&\n      !this.props.maxUndoHistoryExceeded\n    ) {\n      this.props.setMaxUndoHistoryExceeded();\n    }\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.ctrlYTimeout);\n    clearTimeout(this.ctrlZTimeout);\n  }\n\n  handleChangeText(nextText) {\n    const { updateDashboardTitle, onChange } = this.props;\n    if (nextText && this.props.dashboardTitle !== nextText) {\n      updateDashboardTitle(nextText);\n      onChange();\n    }\n  }\n\n  handleCtrlY() {\n    this.props.onRedo();\n    this.setState({ emphasizeRedo: true }, () => {\n      if (this.ctrlYTimeout) clearTimeout(this.ctrlYTimeout);\n      this.ctrlYTimeout = setTimeout(() => {\n        this.setState({ emphasizeRedo: false });\n      }, 100);\n    });\n  }\n\n  handleCtrlZ() {\n    this.props.onUndo();\n    this.setState({ emphasizeUndo: true }, () => {\n      if (this.ctrlZTimeout) clearTimeout(this.ctrlZTimeout);\n      this.ctrlZTimeout = setTimeout(() => {\n        this.setState({ emphasizeUndo: false });\n      }, 100);\n    });\n  }\n\n  forceRefresh() {\n    if (!this.props.isLoading) {\n      const chartList = Object.keys(this.props.charts);\n      this.props.logEvent(LOG_ACTIONS_FORCE_REFRESH_DASHBOARD, {\n        force: true,\n        interval: 0,\n        chartCount: chartList.length,\n      });\n      return this.props.onRefresh(\n        chartList,\n        true,\n        0,\n        this.props.dashboardInfo.id,\n      );\n    }\n    return false;\n  }\n\n  startPeriodicRender(interval) {\n    let intervalMessage;\n    if (interval) {\n      const predefinedValue = PeriodicRefreshOptions.find(\n        option => option.value === interval / 1000,\n      );\n      if (predefinedValue) {\n        intervalMessage = predefinedValue.label;\n      } else {\n        intervalMessage = moment.duration(interval, 'millisecond').humanize();\n      }\n    }\n\n    const periodicRender = () => {\n      const { fetchCharts, logEvent, charts, dashboardInfo } = this.props;\n      const { metadata } = dashboardInfo;\n      const immune = metadata.timed_refresh_immune_slices || [];\n      const affectedCharts = Object.values(charts)\n        .filter(chart => immune.indexOf(chart.id) === -1)\n        .map(chart => chart.id);\n\n      logEvent(LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD, {\n        interval,\n        chartCount: affectedCharts.length,\n      });\n      this.props.addWarningToast(\n        t(\n          `This dashboard is currently force refreshing; the next force refresh will be in %s.`,\n          intervalMessage,\n        ),\n      );\n\n      return fetchCharts(\n        affectedCharts,\n        true,\n        interval * 0.2,\n        dashboardInfo.id,\n      );\n    };\n\n    this.refreshTimer = setPeriodicRunner({\n      interval,\n      periodicRender,\n      refreshTimer: this.refreshTimer,\n    });\n  }\n\n  toggleEditMode() {\n    this.props.logEvent(LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD, {\n      edit_mode: !this.props.editMode,\n    });\n    this.props.setEditMode(!this.props.editMode);\n  }\n\n  overwriteDashboard() {\n    const {\n      dashboardTitle,\n      layout: positions,\n      expandedSlices,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      dashboardInfo,\n      refreshFrequency: currentRefreshFrequency,\n      shouldPersistRefreshFrequency,\n      lastModifiedTime,\n    } = this.props;\n\n    const scale = CategoricalColorNamespace.getScale(\n      colorScheme,\n      colorNamespace,\n    );\n\n    // use the colorScheme for default labels\n    let labelColors = colorScheme ? scale.getColorMap() : {};\n    // but allow metadata to overwrite if it exists\n    // eslint-disable-next-line camelcase\n    const metadataLabelColors = dashboardInfo.metadata?.label_colors;\n    if (metadataLabelColors) {\n      labelColors = { ...labelColors, ...metadataLabelColors };\n    }\n\n    // check refresh frequency is for current session or persist\n    const refreshFrequency = shouldPersistRefreshFrequency\n      ? currentRefreshFrequency\n      : dashboardInfo.metadata?.refresh_frequency; // eslint-disable-line camelcase\n\n    const data = {\n      positions,\n      expanded_slices: expandedSlices,\n      css: customCss,\n      color_namespace: colorNamespace,\n      color_scheme: colorScheme,\n      label_colors: labelColors,\n      dashboard_title: dashboardTitle,\n      refresh_frequency: refreshFrequency,\n      last_modified_time: lastModifiedTime,\n    };\n\n    // make sure positions data less than DB storage limitation:\n    const positionJSONLength = safeStringify(positions).length;\n    const limit =\n      dashboardInfo.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT ||\n      DASHBOARD_POSITION_DATA_LIMIT;\n    if (positionJSONLength >= limit) {\n      this.props.addDangerToast(\n        t(\n          'Your dashboard is too large. Please reduce its size before saving it.',\n        ),\n      );\n    } else {\n      if (positionJSONLength >= limit * 0.9) {\n        this.props.addWarningToast('Your dashboard is near the size limit.');\n      }\n\n      this.props.onSave(data, dashboardInfo.id, SAVE_TYPE_OVERWRITE);\n    }\n  }\n\n  showPropertiesModal() {\n    this.setState({ showingPropertiesModal: true });\n  }\n\n  hidePropertiesModal() {\n    this.setState({ showingPropertiesModal: false });\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      layout,\n      expandedSlices,\n      customCss,\n      colorNamespace,\n      dataMask,\n      setColorSchemeAndUnsavedChanges,\n      colorScheme,\n      onUndo,\n      onRedo,\n      undoLength,\n      redoLength,\n      onChange,\n      onSave,\n      updateCss,\n      editMode,\n      isPublished,\n      userId,\n      dashboardInfo,\n      hasUnsavedChanges,\n      isLoading,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      setRefreshFrequency,\n      lastModifiedTime,\n    } = this.props;\n\n    const userCanEdit = dashboardInfo.dash_edit_perm;\n    const userCanShare = dashboardInfo.dash_share_perm;\n    const userCanSaveAs = dashboardInfo.dash_save_perm;\n    const refreshLimit =\n      dashboardInfo.common.conf.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT;\n    const refreshWarning =\n      dashboardInfo.common.conf\n        .SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;\n\n    return (\n      <StyledDashboardHeader\n        className=\"dashboard-header\"\n        data-test=\"dashboard-header\"\n        data-test-id={`${dashboardInfo.id}`}\n      >\n        <div className=\"dashboard-component-header header-large\">\n          <EditableTitle\n            title={dashboardTitle}\n            canEdit={userCanEdit && editMode}\n            onSaveTitle={this.handleChangeText}\n            showTooltip={false}\n          />\n          <PublishedStatus\n            dashboardId={dashboardInfo.id}\n            isPublished={isPublished}\n            savePublished={this.props.savePublished}\n            canEdit={userCanEdit}\n            canSave={userCanSaveAs}\n          />\n          {userId && (\n            <FaveStar\n              itemId={dashboardInfo.id}\n              fetchFaveStar={this.props.fetchFaveStar}\n              saveFaveStar={this.props.saveFaveStar}\n              isStarred={this.props.isStarred}\n              showTooltip\n            />\n          )}\n        </div>\n\n        <div className=\"button-container\">\n          {userCanSaveAs && (\n            <div\n              className=\"button-container\"\n              data-test=\"dashboard-edit-actions\"\n            >\n              {editMode && (\n                <>\n                  <ButtonGroup className=\"m-r-5\">\n                    <Button\n                      buttonSize=\"small\"\n                      onClick={onUndo}\n                      disabled={undoLength < 1}\n                      buttonStyle={\n                        this.state.emphasizeUndo ? 'primary' : undefined\n                      }\n                    >\n                      <i\n                        title=\"Undo\"\n                        className=\"undo-action fa fa-reply\"\n                        data-test=\"undo-action\"\n                      />\n                      &nbsp;\n                    </Button>\n                    <Button\n                      buttonSize=\"small\"\n                      onClick={onRedo}\n                      disabled={redoLength < 1}\n                      buttonStyle={\n                        this.state.emphasizeRedo ? 'primary' : undefined\n                      }\n                    >\n                      &nbsp;\n                      <i title=\"Redo\" className=\"redo-action fa fa-share\" />\n                    </Button>\n                  </ButtonGroup>\n                  <Button\n                    buttonSize=\"small\"\n                    className=\"m-r-5\"\n                    onClick={this.constructor.discardChanges}\n                    buttonStyle=\"default\"\n                    data-test=\"discard-changes-button\"\n                  >\n                    {t('Discard changes')}\n                  </Button>\n                  <Button\n                    buttonSize=\"small\"\n                    disabled={!hasUnsavedChanges}\n                    buttonStyle=\"primary\"\n                    onClick={this.overwriteDashboard}\n                    data-test=\"header-save-button\"\n                  >\n                    {t('Save')}\n                  </Button>\n                </>\n              )}\n            </div>\n          )}\n          {editMode && (\n            <UndoRedoKeyListeners\n              onUndo={this.handleCtrlZ}\n              onRedo={this.handleCtrlY}\n            />\n          )}\n\n          {!editMode && userCanEdit && (\n            <>\n              <span\n                role=\"button\"\n                title={t('Edit dashboard')}\n                tabIndex={0}\n                className=\"action-button\"\n                onClick={this.toggleEditMode}\n              >\n                <Icons.EditAlt />\n              </span>\n            </>\n          )}\n\n          {this.state.showingPropertiesModal && (\n            <PropertiesModal\n              dashboardId={dashboardInfo.id}\n              show={this.state.showingPropertiesModal}\n              onHide={this.hidePropertiesModal}\n              colorScheme={this.props.colorScheme}\n              onSubmit={updates => {\n                const {\n                  dashboardInfoChanged,\n                  dashboardTitleChanged,\n                } = this.props;\n                dashboardInfoChanged({\n                  slug: updates.slug,\n                  metadata: JSON.parse(updates.jsonMetadata),\n                });\n                setColorSchemeAndUnsavedChanges(updates.colorScheme);\n                dashboardTitleChanged(updates.title);\n                if (updates.slug) {\n                  window.history.pushState(\n                    { event: 'dashboard_properties_changed' },\n                    '',\n                    `/superset/dashboard/${updates.slug}/`,\n                  );\n                }\n              }}\n            />\n          )}\n\n          <HeaderActionsDropdown\n            addSuccessToast={this.props.addSuccessToast}\n            addDangerToast={this.props.addDangerToast}\n            dashboardId={dashboardInfo.id}\n            dashboardTitle={dashboardTitle}\n            dashboardInfo={dashboardInfo}\n            dataMask={dataMask}\n            layout={layout}\n            expandedSlices={expandedSlices}\n            customCss={customCss}\n            colorNamespace={colorNamespace}\n            colorScheme={colorScheme}\n            onSave={onSave}\n            onChange={onChange}\n            forceRefreshAllCharts={this.forceRefresh}\n            startPeriodicRender={this.startPeriodicRender}\n            refreshFrequency={refreshFrequency}\n            shouldPersistRefreshFrequency={shouldPersistRefreshFrequency}\n            setRefreshFrequency={setRefreshFrequency}\n            updateCss={updateCss}\n            editMode={editMode}\n            hasUnsavedChanges={hasUnsavedChanges}\n            userCanEdit={userCanEdit}\n            userCanShare={userCanShare}\n            userCanSave={userCanSaveAs}\n            isLoading={isLoading}\n            showPropertiesModal={this.showPropertiesModal}\n            refreshLimit={refreshLimit}\n            refreshWarning={refreshWarning}\n            lastModifiedTime={lastModifiedTime}\n          />\n        </div>\n      </StyledDashboardHeader>\n    );\n  }\n}\n\nHeader.propTypes = propTypes;\nHeader.defaultProps = defaultProps;\n\nexport default Header;\n"]},"metadata":{},"sourceType":"module"}