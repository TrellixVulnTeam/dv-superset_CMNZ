{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _findIndexInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find-index\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\nconst FilterControls = ({ directPathToChild, dataMaskSelected, onFilterSelectionChange }) => {var _context;\n  const [visiblePopoverId, setVisiblePopoverId] = useState(null);\n  const filters = useFilters();\n  const filterValues = _Object$values(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = _mapInstanceProperty(filterValues).call(filterValues, (filter) => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id] }));\n\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterValues, dataMaskSelected]);\n  const cascadeFilterIds = new _Set(_mapInstanceProperty(cascadeFilters).call(cascadeFilters, (item) => item.id));\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(cascadeFilters);\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n  return ___EmotionJSX(Wrapper, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 56, columnNumber: 13 } },\n  _mapInstanceProperty(_context = _filterInstanceProperty(portalNodes).call(portalNodes,\n  (node, index) => cascadeFilterIds.has(filterValues[index].id))).call(_context,\n  (node, index) => ___EmotionJSX(portals.InPortal, { node: node, __self: this, __source: { fileName: _jsxFileName, lineNumber: 59, columnNumber: 36 } },\n  ___EmotionJSX(CascadePopover, { \"data-test\": \"cascade-filters-control\", key: cascadeFilters[index].id, dataMaskSelected: dataMaskSelected, visible: visiblePopoverId === cascadeFilters[index].id, onVisibleChange: (visible) => setVisiblePopoverId(visible ? cascadeFilters[index].id : null), filter: cascadeFilters[index], onFilterSelectionChange: onFilterSelectionChange, directPathToChild: directPathToChild, inView: false, __self: this, __source: { fileName: _jsxFileName, lineNumber: 60, columnNumber: 13 } }))),\n\n  _mapInstanceProperty(filtersInScope).call(filtersInScope, (filter) => {\n    const index = _findIndexInstanceProperty(filterValues).call(filterValues, (f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 64, columnNumber: 20 } });\n  }),\n  showCollapsePanel && ___EmotionJSX(Collapse, { ghost: true, bordered: true, expandIconPosition: \"right\", collapsible: filtersOutOfScope.length === 0 ? 'disabled' : undefined, css: (theme) => /*#__PURE__*/css(\"&.ant-collapse{margin-top:\",\n\n    filtersInScope.length > 0 ?\n    theme.gridUnit * 6 :\n    0, \"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:\",\n\n\n\n    theme.gridUnit * 2, \"px;&>.ant-collapse-arrow{right:\",\n\n\n    theme.gridUnit, \"px;}}& .ant-collapse-content-box{padding:\",\n\n\n\n\n    theme.gridUnit * 4, \"px 0 0;}}}\" + (process.env.NODE_ENV === \"production\" ? \"\" : \";label:FilterControls;\"), process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9mcmFua2hlL3Byb2plY3RzL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9uYXRpdmVGaWx0ZXJzL0ZpbHRlckJhci9GaWx0ZXJDb250cm9scy9GaWx0ZXJDb250cm9scy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUV5SyIsImZpbGUiOiIvVXNlcnMvZnJhbmtoZS9wcm9qZWN0cy9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvbmF0aXZlRmlsdGVycy9GaWx0ZXJCYXIvRmlsdGVyQ29udHJvbHMvRmlsdGVyQ29udHJvbHMudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc3R5bGVkLCB0IH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnQGVtb3Rpb24vcmVhY3QnO1xuaW1wb3J0ICogYXMgcG9ydGFscyBmcm9tICdyZWFjdC1yZXZlcnNlLXBvcnRhbCc7XG5pbXBvcnQgeyBDb2xsYXBzZSB9IGZyb20gJ3NyYy9jb21tb24vY29tcG9uZW50cyc7XG5pbXBvcnQgQ2FzY2FkZVBvcG92ZXIgZnJvbSAnLi4vQ2FzY2FkZUZpbHRlcnMvQ2FzY2FkZVBvcG92ZXInO1xuaW1wb3J0IHsgYnVpbGRDYXNjYWRlRmlsdGVyc1RyZWUgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IHVzZUZpbHRlcnMgfSBmcm9tICcuLi9zdGF0ZSc7XG5pbXBvcnQgeyB1c2VEYXNoYm9hcmRIYXNUYWJzLCB1c2VTZWxlY3RGaWx0ZXJzSW5TY29wZSB9IGZyb20gJy4uLy4uL3N0YXRlJztcbmNvbnN0IFdyYXBwZXIgPSBzdHlsZWQuZGl2IGBcbiAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDR9cHg7XG4gICY6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgfVxuYDtcbmNvbnN0IEZpbHRlckNvbnRyb2xzID0gKHsgZGlyZWN0UGF0aFRvQ2hpbGQsIGRhdGFNYXNrU2VsZWN0ZWQsIG9uRmlsdGVyU2VsZWN0aW9uQ2hhbmdlLCB9KSA9PiB7XG4gICAgY29uc3QgW3Zpc2libGVQb3BvdmVySWQsIHNldFZpc2libGVQb3BvdmVySWRdID0gdXNlU3RhdGUobnVsbCk7XG4gICAgY29uc3QgZmlsdGVycyA9IHVzZUZpbHRlcnMoKTtcbiAgICBjb25zdCBmaWx0ZXJWYWx1ZXMgPSBPYmplY3QudmFsdWVzKGZpbHRlcnMpO1xuICAgIGNvbnN0IHBvcnRhbE5vZGVzID0gUmVhY3QudXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IG5vZGVzID0gbmV3IEFycmF5KGZpbHRlclZhbHVlcy5sZW5ndGgpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbHRlclZhbHVlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgbm9kZXNbaV0gPSBwb3J0YWxzLmNyZWF0ZUh0bWxQb3J0YWxOb2RlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGVzO1xuICAgIH0sIFtmaWx0ZXJWYWx1ZXMubGVuZ3RoXSk7XG4gICAgY29uc3QgY2FzY2FkZUZpbHRlcnMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3QgZmlsdGVyc1dpdGhWYWx1ZSA9IGZpbHRlclZhbHVlcy5tYXAoZmlsdGVyID0+ICh7XG4gICAgICAgICAgICAuLi5maWx0ZXIsXG4gICAgICAgICAgICBkYXRhTWFzazogZGF0YU1hc2tTZWxlY3RlZFtmaWx0ZXIuaWRdLFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiBidWlsZENhc2NhZGVGaWx0ZXJzVHJlZShmaWx0ZXJzV2l0aFZhbHVlKTtcbiAgICB9LCBbZmlsdGVyVmFsdWVzLCBkYXRhTWFza1NlbGVjdGVkXSk7XG4gICAgY29uc3QgY2FzY2FkZUZpbHRlcklkcyA9IG5ldyBTZXQoY2FzY2FkZUZpbHRlcnMubWFwKGl0ZW0gPT4gaXRlbS5pZCkpO1xuICAgIGNvbnN0IFtmaWx0ZXJzSW5TY29wZSwgZmlsdGVyc091dE9mU2NvcGVdID0gdXNlU2VsZWN0RmlsdGVyc0luU2NvcGUoY2FzY2FkZUZpbHRlcnMpO1xuICAgIGNvbnN0IGRhc2hib2FyZEhhc1RhYnMgPSB1c2VEYXNoYm9hcmRIYXNUYWJzKCk7XG4gICAgY29uc3Qgc2hvd0NvbGxhcHNlUGFuZWwgPSBkYXNoYm9hcmRIYXNUYWJzICYmIGNhc2NhZGVGaWx0ZXJzLmxlbmd0aCA+IDA7XG4gICAgcmV0dXJuICg8V3JhcHBlcj5cbiAgICAgIHtwb3J0YWxOb2Rlc1xuICAgICAgICAgICAgLmZpbHRlcigobm9kZSwgaW5kZXgpID0+IGNhc2NhZGVGaWx0ZXJJZHMuaGFzKGZpbHRlclZhbHVlc1tpbmRleF0uaWQpKVxuICAgICAgICAgICAgLm1hcCgobm9kZSwgaW5kZXgpID0+ICg8cG9ydGFscy5JblBvcnRhbCBub2RlPXtub2RlfT5cbiAgICAgICAgICAgIDxDYXNjYWRlUG9wb3ZlciBkYXRhLXRlc3Q9XCJjYXNjYWRlLWZpbHRlcnMtY29udHJvbFwiIGtleT17Y2FzY2FkZUZpbHRlcnNbaW5kZXhdLmlkfSBkYXRhTWFza1NlbGVjdGVkPXtkYXRhTWFza1NlbGVjdGVkfSB2aXNpYmxlPXt2aXNpYmxlUG9wb3ZlcklkID09PSBjYXNjYWRlRmlsdGVyc1tpbmRleF0uaWR9IG9uVmlzaWJsZUNoYW5nZT17dmlzaWJsZSA9PiBzZXRWaXNpYmxlUG9wb3ZlcklkKHZpc2libGUgPyBjYXNjYWRlRmlsdGVyc1tpbmRleF0uaWQgOiBudWxsKX0gZmlsdGVyPXtjYXNjYWRlRmlsdGVyc1tpbmRleF19IG9uRmlsdGVyU2VsZWN0aW9uQ2hhbmdlPXtvbkZpbHRlclNlbGVjdGlvbkNoYW5nZX0gZGlyZWN0UGF0aFRvQ2hpbGQ9e2RpcmVjdFBhdGhUb0NoaWxkfSBpblZpZXc9e2ZhbHNlfS8+XG4gICAgICAgICAgPC9wb3J0YWxzLkluUG9ydGFsPikpfVxuICAgICAge2ZpbHRlcnNJblNjb3BlLm1hcChmaWx0ZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmaWx0ZXJWYWx1ZXMuZmluZEluZGV4KGYgPT4gZi5pZCA9PT0gZmlsdGVyLmlkKTtcbiAgICAgICAgICAgIHJldHVybiA8cG9ydGFscy5PdXRQb3J0YWwgbm9kZT17cG9ydGFsTm9kZXNbaW5kZXhdfSBpblZpZXcvPjtcbiAgICAgICAgfSl9XG4gICAgICB7c2hvd0NvbGxhcHNlUGFuZWwgJiYgKDxDb2xsYXBzZSBnaG9zdCBib3JkZXJlZCBleHBhbmRJY29uUG9zaXRpb249XCJyaWdodFwiIGNvbGxhcHNpYmxlPXtmaWx0ZXJzT3V0T2ZTY29wZS5sZW5ndGggPT09IDAgPyAnZGlzYWJsZWQnIDogdW5kZWZpbmVkfSBjc3M9e3RoZW1lID0+IGNzcyBgXG4gICAgICAgICAgICAmLmFudC1jb2xsYXBzZSB7XG4gICAgICAgICAgICAgIG1hcmdpbi10b3A6ICR7ZmlsdGVyc0luU2NvcGUubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgID8gdGhlbWUuZ3JpZFVuaXQgKiA2XG4gICAgICAgICAgICAgICAgOiAwfXB4O1xuICAgICAgICAgICAgICAmID4gLmFudC1jb2xsYXBzZS1pdGVtIHtcbiAgICAgICAgICAgICAgICAmID4gLmFudC1jb2xsYXBzZS1oZWFkZXIge1xuICAgICAgICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAwO1xuICAgICAgICAgICAgICAgICAgcGFkZGluZy1ib3R0b206ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuXG4gICAgICAgICAgICAgICAgICAmID4gLmFudC1jb2xsYXBzZS1hcnJvdyB7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0OiAke3RoZW1lLmdyaWRVbml0fXB4O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICYgLmFudC1jb2xsYXBzZS1jb250ZW50LWJveCB7XG4gICAgICAgICAgICAgICAgICBwYWRkaW5nOiAke3RoZW1lLmdyaWRVbml0ICogNH1weCAwIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgYH0+XG4gICAgICAgICAgPENvbGxhcHNlLlBhbmVsIGhlYWRlcj17YCR7dCgnRmlsdGVycyBvdXQgb2Ygc2NvcGUnKX0gKCR7ZmlsdGVyc091dE9mU2NvcGUubGVuZ3RofSlgfSBrZXk9XCIxXCI+XG4gICAgICAgICAgICB7ZmlsdGVyc091dE9mU2NvcGUubWFwKGZpbHRlciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjYXNjYWRlRmlsdGVycy5maW5kSW5kZXgoZiA9PiBmLmlkID09PSBmaWx0ZXIuaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiA8cG9ydGFscy5PdXRQb3J0YWwgbm9kZT17cG9ydGFsTm9kZXNbaW5kZXhdfSBpblZpZXcvPjtcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgIDwvQ29sbGFwc2UuUGFuZWw+XG4gICAgICAgIDwvQ29sbGFwc2U+KX1cbiAgICA8L1dyYXBwZXI+KTtcbn07XG5leHBvcnQgZGVmYXVsdCBGaWx0ZXJDb250cm9scztcbiJdfQ== */\"), __self: this, __source: { fileName: _jsxFileName, lineNumber: 66, columnNumber: 30 } },\n\n\n\n\n  ___EmotionJSX(Collapse.Panel, { header: `${t('Filters out of scope')} (${filtersOutOfScope.length})`, key: \"1\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 87, columnNumber: 11 } },\n  _mapInstanceProperty(filtersOutOfScope).call(filtersOutOfScope, (filter) => {\n    const index = _findIndexInstanceProperty(cascadeFilters).call(cascadeFilters, (f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 90, columnNumber: 24 } });\n  }))));\n\n\n\n};__signature__(FilterControls, \"useState{[visiblePopoverId, setVisiblePopoverId](null)}\\nuseFilters{filters}\\nuseMemo{portalNodes}\\nuseMemo{cascadeFilters}\\nuseSelectFiltersInScope{[filtersInScope, filtersOutOfScope]}\\nuseDashboardHasTabs{dashboardHasTabs}\", () => [useFilters, useSelectFiltersInScope, useDashboardHasTabs]);const _default =\nFilterControls;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(Wrapper, \"Wrapper\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(FilterControls, \"FilterControls\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx"],"names":[],"mappings":"+5BAAA;;;;;;;;;;;;;;;;;AAiBG;AACH,OAAO,KAAP,IAAoB,OAApB,EAA6B,QAA7B,QAA6C,OAA7C;AACA,SAAmB,MAAnB,EAA2B,CAA3B,QAAoC,mBAApC;AACA,SAAS,GAAT,QAAoB,gBAApB;AACA,OAAO,KAAK,OAAZ,MAAyB,sBAAzB;AAEA,SAAS,QAAT,QAAyB,uBAAzB;AACA,OAAO,cAAP,MAA2B,kCAA3B;AACA,SAAS,uBAAT,QAAwC,SAAxC;AACA,SAAS,UAAT,QAA2B,UAA3B;AAEA,SAAS,mBAAT,EAA8B,uBAA9B,QAA6D,aAA7D,C;AAEA,MAAM,OAAO,GAAG,MAAM,CAAC,GAAG;aACb,CAAC,EAAE,KAAF,EAAD,KAAe,KAAK,CAAC,QAAN,GAAiB,CAAC;;;;AAI7C,CALD;AAaA,MAAM,cAAc,GAA4B,CAAC,EAC/C,iBAD+C,EAE/C,gBAF+C,EAG/C,uBAH+C,EAAD,KAI3C;AACH,QAAM,CAAC,gBAAD,EAAmB,mBAAnB,IAA0C,QAAQ,CAAgB,IAAhB,CAAxD;AACA,QAAM,OAAO,GAAG,UAAU,EAA1B;AACA,QAAM,YAAY,GAAG,eAAsB,OAAtB,CAArB;AACA,QAAM,WAAW,GAAG,KAAK,CAAC,OAAN,CAAc,MAAK;AACrC,UAAM,KAAK,GAAG,IAAI,KAAJ,CAAU,YAAY,CAAC,MAAvB,CAAd;AACA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,YAAY,CAAC,MAAjC,EAAyC,CAAC,IAAI,CAA9C,EAAiD;AAC/C,MAAA,KAAK,CAAC,CAAD,CAAL,GAAW,OAAO,CAAC,oBAAR,EAAX;AACD;AACD,WAAO,KAAP;AACD,GANmB,EAMjB,CAAC,YAAY,CAAC,MAAd,CANiB,CAApB;AAQA,QAAM,cAAc,GAAG,OAAO,CAAC,MAAK;AAClC,UAAM,gBAAgB,GAAG,qBAAA,YAAY,MAAZ,CAAA,YAAY,EAAK,CAAA,MAAM,MAAK;AACnD,SAAG,MADgD;AAEnD,MAAA,QAAQ,EAAE,gBAAgB,CAAC,MAAM,CAAC,EAAR,CAFyB,EAAL,CAAX,CAArC;;AAIA,WAAO,uBAAuB,CAAC,gBAAD,CAA9B;AACD,GAN6B,EAM3B,CAAC,YAAD,EAAe,gBAAf,CAN2B,CAA9B;AAOA,QAAM,gBAAgB,GAAG,SAAQ,qBAAA,cAAc,MAAd,CAAA,cAAc,EAAK,CAAA,IAAI,KAAI,IAAI,CAAC,EAAlB,CAAtB,CAAzB;AAEA,QAAM,CAAC,cAAD,EAAiB,iBAAjB,IAAsC,uBAAuB,CACjE,cADiE,CAAnE;AAGA,QAAM,gBAAgB,GAAG,mBAAmB,EAA5C;AACA,QAAM,iBAAiB,GAAG,gBAAgB,IAAI,cAAc,CAAC,MAAf,GAAwB,CAAtE;AAEA,SACE,cAAC,OAAD;AACG,0DAAA,WAAW,MAAX,CAAA,WAAW;AACF,GAAC,IAAD,EAAO,KAAP,KAAiB,gBAAgB,CAAC,GAAjB,CAAqB,YAAY,CAAC,KAAD,CAAZ,CAAoB,EAAzC,CADf,CAAX;AAEM,GAAC,IAAD,EAAO,KAAP,KACH,cAAC,OAAD,CAAS,QAAT,IAAkB,IAAI,EAAE,IAAxB;AACE,gBAAC,cAAD,IACE,aAAU,yBADZ,EAEE,GAAG,EAAE,cAAc,CAAC,KAAD,CAAd,CAAsB,EAF7B,EAGE,gBAAgB,EAAE,gBAHpB,EAIE,OAAO,EAAE,gBAAgB,KAAK,cAAc,CAAC,KAAD,CAAd,CAAsB,EAJtD,EAKE,eAAe,EAAE,CAAA,OAAO,KACtB,mBAAmB,CAAC,OAAO,GAAG,cAAc,CAAC,KAAD,CAAd,CAAsB,EAAzB,GAA8B,IAAtC,CANvB,EAQE,MAAM,EAAE,cAAc,CAAC,KAAD,CARxB,EASE,uBAAuB,EAAE,uBAT3B,EAUE,iBAAiB,EAAE,iBAVrB,EAWE,MAAM,EAAE,KAXV,yFADF,CAHH,CADH;;AAoBG,uBAAA,cAAc,MAAd,CAAA,cAAc,EAAK,CAAA,MAAM,KAAG;AAC3B,UAAM,KAAK,GAAG,2BAAA,YAAY,MAAZ,CAAA,YAAY,EAAW,CAAA,CAAC,KAAI,CAAC,CAAC,EAAF,KAAS,MAAM,CAAC,EAAhC,CAA1B;AACA,WAAO,cAAC,OAAD,CAAS,SAAT,IAAmB,IAAI,EAAE,WAAW,CAAC,KAAD,CAApC,EAA6C,MAAM,MAAnD,yFAAP;AACD,GAHc,CApBjB;AAwBG,EAAA,iBAAiB,IAChB,cAAC,QAAD,IACE,KAAK,MADP,EAEE,QAAQ,MAFV,EAGE,kBAAkB,EAAC,OAHrB,EAIE,WAAW,EAAE,iBAAiB,CAAC,MAAlB,KAA6B,CAA7B,GAAiC,UAAjC,GAA8C,SAJ7D,EAKE,GAAG,EAAE,CAAA,KAAK,kBAAI,GAAJ;;AAEQ,IAAA,cAAc,CAAC,MAAf,GAAwB,CAAxB;AACV,IAAA,KAAK,CAAC,QAAN,GAAiB,CADP;AAEV,KAJE;;;;AAQgB,IAAA,KAAK,CAAC,QAAN,GAAiB,CARjC;;;AAWS,IAAA,KAAK,CAAC,QAXf;;;;;AAgBS,IAAA,KAAK,CAAC,QAAN,GAAiB,CAhB1B,ivNALZ;;;;;AA2BE,gBAAC,QAAD,CAAU,KAAV,IACE,MAAM,EAAE,GAAG,CAAC,CAAC,sBAAD,CAAwB,KAClC,iBAAiB,CAAC,MACpB,GAHF,EAIE,GAAG,EAAC,GAJN;AAMG,uBAAA,iBAAiB,MAAjB,CAAA,iBAAiB,EAAK,CAAA,MAAM,KAAG;AAC9B,UAAM,KAAK,GAAG,2BAAA,cAAc,MAAd,CAAA,cAAc,EAAW,CAAA,CAAC,KAAI,CAAC,CAAC,EAAF,KAAS,MAAM,CAAC,EAAhC,CAA5B;AACA,WAAO,cAAC,OAAD,CAAS,SAAT,IAAmB,IAAI,EAAE,WAAW,CAAC,KAAD,CAApC,EAA6C,MAAM,MAAnD,yFAAP;AACD,GAHiB,CANpB,CA3BF,CAzBJ,CADF;;;;AAoED,CAnGD,C,cAAM,c,6OAMY,U,EAmB4B,uB,EAGnB,mB;AAyEZ,c,CAAf,wB,iLAlHM,O,8KAaA,c","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useMemo, useState } from 'react';\nimport { DataMask, styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { DataMaskStateWithId } from 'src/dataMask/types';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { Filter } from '../../types';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';\n\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\ntype FilterControlsProps = {\n  directPathToChild?: string[];\n  dataMaskSelected: DataMaskStateWithId;\n  onFilterSelectionChange: (filter: Filter, dataMask: DataMask) => void;\n};\n\nconst FilterControls: FC<FilterControlsProps> = ({\n  directPathToChild,\n  dataMaskSelected,\n  onFilterSelectionChange,\n}) => {\n  const [visiblePopoverId, setVisiblePopoverId] = useState<string | null>(null);\n  const filters = useFilters();\n  const filterValues = Object.values<Filter>(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterValues.map(filter => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id],\n    }));\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterValues, dataMaskSelected]);\n  const cascadeFilterIds = new Set(cascadeFilters.map(item => item.id));\n\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(\n    cascadeFilters,\n  );\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n\n  return (\n    <Wrapper>\n      {portalNodes\n        .filter((node, index) => cascadeFilterIds.has(filterValues[index].id))\n        .map((node, index) => (\n          <portals.InPortal node={node}>\n            <CascadePopover\n              data-test=\"cascade-filters-control\"\n              key={cascadeFilters[index].id}\n              dataMaskSelected={dataMaskSelected}\n              visible={visiblePopoverId === cascadeFilters[index].id}\n              onVisibleChange={visible =>\n                setVisiblePopoverId(visible ? cascadeFilters[index].id : null)\n              }\n              filter={cascadeFilters[index]}\n              onFilterSelectionChange={onFilterSelectionChange}\n              directPathToChild={directPathToChild}\n              inView={false}\n            />\n          </portals.InPortal>\n        ))}\n      {filtersInScope.map(filter => {\n        const index = filterValues.findIndex(f => f.id === filter.id);\n        return <portals.OutPortal node={portalNodes[index]} inView />;\n      })}\n      {showCollapsePanel && (\n        <Collapse\n          ghost\n          bordered\n          expandIconPosition=\"right\"\n          collapsible={filtersOutOfScope.length === 0 ? 'disabled' : undefined}\n          css={theme => css`\n            &.ant-collapse {\n              margin-top: ${filtersInScope.length > 0\n                ? theme.gridUnit * 6\n                : 0}px;\n              & > .ant-collapse-item {\n                & > .ant-collapse-header {\n                  padding-left: 0;\n                  padding-bottom: ${theme.gridUnit * 2}px;\n\n                  & > .ant-collapse-arrow {\n                    right: ${theme.gridUnit}px;\n                  }\n                }\n\n                & .ant-collapse-content-box {\n                  padding: ${theme.gridUnit * 4}px 0 0;\n                }\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            header={`${t('Filters out of scope')} (${\n              filtersOutOfScope.length\n            })`}\n            key=\"1\"\n          >\n            {filtersOutOfScope.map(filter => {\n              const index = cascadeFilters.findIndex(f => f.id === filter.id);\n              return <portals.OutPortal node={portalNodes[index]} inView />;\n            })}\n          </Collapse.Panel>\n        </Collapse>\n      )}\n    </Wrapper>\n  );\n};\n\nexport default FilterControls;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}