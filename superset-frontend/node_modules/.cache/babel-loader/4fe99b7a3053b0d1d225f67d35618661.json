{"ast":null,"code":"import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { useTheme } from '@superset-ui/core';\nimport { useSelector } from 'react-redux';\n\nimport { getChartIdsInFilterScope } from 'src/dashboard/util/activeDashboardFilters';\nimport Chart from '../../containers/Chart';\nimport AnchorLink from '../../../components/AnchorLink';\nimport DeleteComponentButton from '../DeleteComponentButton';\nimport DragDroppable from '../dnd/DragDroppable';\nimport HoverMenu from '../menu/HoverMenu';\nimport ResizableContainer from '../resizable/ResizableContainer';\nimport getChartAndLabelComponentIdFromPath from '../../util/getChartAndLabelComponentIdFromPath';\nimport { componentShape } from '../../util/propShapes';\nimport { COLUMN_TYPE, ROW_TYPE } from '../../util/componentTypes';\n\nimport {\nGRID_BASE_UNIT,\nGRID_GUTTER_SIZE,\nGRID_MIN_COLUMN_COUNT,\nGRID_MIN_ROW_UNITS } from\n'../../util/constants';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst CHART_MARGIN = 32;\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  parentId: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  component: componentShape.isRequired,\n  parentComponent: componentShape.isRequired,\n  index: PropTypes.number.isRequired,\n  depth: PropTypes.number.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  directPathToChild: PropTypes.arrayOf(PropTypes.string),\n  directPathLastUpdated: PropTypes.number,\n  focusedFilterScope: PropTypes.object,\n  fullSizeChartId: PropTypes.oneOf([PropTypes.number, null]),\n\n  // grid related\n  availableColumnCount: PropTypes.number.isRequired,\n  columnWidth: PropTypes.number.isRequired,\n  onResizeStart: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  onResizeStop: PropTypes.func.isRequired,\n\n  // dnd\n  deleteComponent: PropTypes.func.isRequired,\n  updateComponents: PropTypes.func.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  setFullSizeChartId: PropTypes.func.isRequired };\n\n\nconst defaultProps = {\n  directPathToChild: [],\n  directPathLastUpdated: 0 };\n\n\n/**\n * Selects the chart scope of the filter input that has focus.\n *\n * @returns {{chartId: number, scope: { scope: string[], immune: string[] }} | null }\n * the scope of the currently focused filter, if any\n */\nfunction selectFocusedFilterScope(dashboardState, dashboardFilters) {\n  if (!dashboardState.focusedFilterField) return null;\n  const { chartId, column } = dashboardState.focusedFilterField;\n  return {\n    chartId,\n    scope: dashboardFilters[chartId].scopes[column] };\n\n}\n\n/**\n * Renders any styles necessary to highlight the chart's relationship to the focused filter.\n *\n * If there is no focused filter scope (i.e. most of the time), this will be just a pass-through.\n *\n * If the chart is outside the scope of the focused filter, dims the chart.\n *\n * If the chart is in the scope of the focused filter,\n * renders a highlight around the chart.\n *\n * If ChartHolder were a function component, this could be implemented as a hook instead.\n */\nconst FilterFocusHighlight = /*#__PURE__*/React.forwardRef(__signature__(\n({ chartId, ...otherProps }, ref) => {var _context;\n  const theme = useTheme();\n\n  const nativeFilters = useSelector((state) => state.nativeFilters);\n  const dashboardState = useSelector((state) => state.dashboardState);\n  const dashboardFilters = useSelector((state) => state.dashboardFilters);\n  const focusedFilterScope = selectFocusedFilterScope(\n  dashboardState,\n  dashboardFilters);\n\n  const focusedNativeFilterId = nativeFilters.focusedFilterId;\n  if (!(focusedFilterScope || focusedNativeFilterId))\n  return ___EmotionJSX(\"div\", _extends({ ref: ref }, otherProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 118, columnNumber: 14 } }));\n\n  // we use local styles here instead of a conditionally-applied class,\n  // because adding any conditional class to this container\n  // causes performance issues in Chrome.\n\n  // default to the \"de-emphasized\" state\n  const unfocusedChartStyles = { opacity: 0.3, pointerEvents: 'none' };\n  const focusedChartStyles = {\n    borderColor: theme.colors.primary.light2,\n    opacity: 1,\n    boxShadow: `0px 0px ${theme.gridUnit * 2}px ${theme.colors.primary.base}`,\n    pointerEvents: 'auto' };\n\n\n  if (focusedNativeFilterId) {var _nativeFilters$filter, _nativeFilters$filter2;\n    if ((_nativeFilters$filter =\n    nativeFilters.filters[focusedNativeFilterId]) != null && (_nativeFilters$filter2 = _nativeFilters$filter.chartsInScope) != null && _includesInstanceProperty(_nativeFilters$filter2).call(_nativeFilters$filter2,\n    chartId))\n\n    {\n      return ___EmotionJSX(\"div\", _extends({ ref: ref, style: focusedChartStyles }, otherProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 139, columnNumber: 16 } }));\n    }\n  } else if (\n  chartId === focusedFilterScope.chartId ||\n  _includesInstanceProperty(_context = getChartIdsInFilterScope({\n    filterScope: focusedFilterScope.scope })).call(_context,\n  chartId))\n  {\n    return ___EmotionJSX(\"div\", _extends({ ref: ref, style: focusedChartStyles }, otherProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 147, columnNumber: 14 } }));\n  }\n\n  // inline styles are used here due to a performance issue when adding/changing a class, which causes a reflow\n  return ___EmotionJSX(\"div\", _extends({ ref: ref, style: unfocusedChartStyles }, otherProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 151, columnNumber: 12 } }));\n}, \"useTheme{theme}\\nuseSelector{nativeFilters}\\nuseSelector{dashboardState}\\nuseSelector{dashboardFilters}\", () => [useTheme, useSelector, useSelector, useSelector]));\n\n\nclass ChartHolder extends React.Component {\n  static renderInFocusCSS(columnName) {\n    return (\n      ___EmotionJSX(\"style\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 158, columnNumber: 7 } },\n      `label[for=${columnName}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`));\n\n\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    const { component, directPathToChild, directPathLastUpdated } = props;\n    const {\n      label: columnName,\n      chart: chartComponentId } =\n    getChartAndLabelComponentIdFromPath(directPathToChild);\n\n    if (\n    directPathLastUpdated !== state.directPathLastUpdated &&\n    component.id === chartComponentId)\n    {\n      return {\n        outlinedComponentId: component.id,\n        outlinedColumnName: columnName,\n        directPathLastUpdated };\n\n    }\n    return null;\n  }\n\n  constructor(props) {var _context2, _context3, _context4, _context5;\n    super(props);\n    this.state = {\n      isFocused: false,\n      outlinedComponentId: null,\n      outlinedColumnName: null,\n      directPathLastUpdated: 0 };\n\n\n    this.handleChangeFocus = _bindInstanceProperty(_context2 = this.handleChangeFocus).call(_context2, this);\n    this.handleDeleteComponent = _bindInstanceProperty(_context3 = this.handleDeleteComponent).call(_context3, this);\n    this.handleUpdateSliceName = _bindInstanceProperty(_context4 = this.handleUpdateSliceName).call(_context4, this);\n    this.handleToggleFullSize = _bindInstanceProperty(_context5 = this.handleToggleFullSize).call(_context5, this);\n  }\n\n  componentDidMount() {\n    this.hideOutline({}, this.state);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.hideOutline(prevState, this.state);\n  }\n\n  hideOutline(prevState, state) {\n    const { outlinedComponentId: timerKey } = state;\n    const { outlinedComponentId: prevTimerKey } = prevState;\n\n    // because of timeout, there might be multiple charts showing outline\n    if (!!timerKey && !prevTimerKey) {\n      _setTimeout(() => {\n        this.setState(() => ({\n          outlinedComponentId: null,\n          outlinedColumnName: null }));\n\n      }, 2000);\n    }\n  }\n\n  handleChangeFocus(nextFocus) {\n    this.setState(() => ({ isFocused: nextFocus }));\n  }\n\n  handleDeleteComponent() {\n    const { deleteComponent, id, parentId } = this.props;\n    deleteComponent(id, parentId);\n  }\n\n  handleUpdateSliceName(nextName) {\n    const { component, updateComponents } = this.props;\n    updateComponents({\n      [component.id]: {\n        ...component,\n        meta: {\n          ...component.meta,\n          sliceNameOverride: nextName } } });\n\n\n\n  }\n\n  handleToggleFullSize() {\n    const { component, fullSizeChartId, setFullSizeChartId } = this.props;\n    const { chartId } = component.meta;\n    const isFullSize = fullSizeChartId === chartId;\n    setFullSizeChartId(isFullSize ? null : chartId);\n  }\n\n  render() {\n    const { isFocused } = this.state;\n    const {\n      component,\n      parentComponent,\n      index,\n      depth,\n      availableColumnCount,\n      columnWidth,\n      onResizeStart,\n      onResize,\n      onResizeStop,\n      handleComponentDrop,\n      editMode,\n      isComponentVisible,\n      dashboardId,\n      fullSizeChartId } =\n    this.props;\n\n    const { chartId } = component.meta;\n    const isFullSize = fullSizeChartId === chartId;\n\n    // inherit the size of parent columns\n    const widthMultiple =\n    parentComponent.type === COLUMN_TYPE ?\n    parentComponent.meta.width || GRID_MIN_COLUMN_COUNT :\n    component.meta.width || GRID_MIN_COLUMN_COUNT;\n\n    let chartWidth = 0;\n    let chartHeight = 0;\n\n    if (isFullSize) {\n      chartWidth = window.innerWidth - CHART_MARGIN;\n      chartHeight = window.innerHeight - CHART_MARGIN;\n    } else {\n      chartWidth = Math.floor(\n      widthMultiple * columnWidth +\n      (widthMultiple - 1) * GRID_GUTTER_SIZE -\n      CHART_MARGIN);\n\n      chartHeight = Math.floor(\n      component.meta.height * GRID_BASE_UNIT - CHART_MARGIN);\n\n    }\n\n    return (\n      ___EmotionJSX(DragDroppable, {\n        component: component,\n        parentComponent: parentComponent,\n        orientation: parentComponent.type === ROW_TYPE ? 'column' : 'row',\n        index: index,\n        depth: depth,\n        onDrop: handleComponentDrop,\n        disableDragDrop: isFocused,\n        editMode: editMode, __self: this, __source: { fileName: _jsxFileName, lineNumber: 300, columnNumber: 7 } },\n\n      ({ dropIndicatorProps, dragSourceRef }) =>\n      ___EmotionJSX(ResizableContainer, {\n        id: component.id,\n        adjustableWidth: parentComponent.type === ROW_TYPE,\n        adjustableHeight: true,\n        widthStep: columnWidth,\n        widthMultiple: widthMultiple,\n        heightStep: GRID_BASE_UNIT,\n        heightMultiple: component.meta.height,\n        minWidthMultiple: GRID_MIN_COLUMN_COUNT,\n        minHeightMultiple: GRID_MIN_ROW_UNITS,\n        maxWidthMultiple: availableColumnCount + widthMultiple,\n        onResizeStart: onResizeStart,\n        onResize: onResize,\n        onResizeStop: onResizeStop,\n        editMode: editMode, __self: this, __source: { fileName: _jsxFileName, lineNumber: 311, columnNumber: 11 } },\n\n      ___EmotionJSX(FilterFocusHighlight, {\n        chartId: chartId,\n        ref: dragSourceRef,\n        \"data-test\": \"dashboard-component-chart-holder\",\n        className: cx(\n        'dashboard-component',\n        'dashboard-component-chart-holder',\n        this.state.outlinedComponentId ? 'fade-in' : 'fade-out',\n        isFullSize && 'full-size'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 327, columnNumber: 13 } },\n\n\n      !editMode &&\n      ___EmotionJSX(AnchorLink, {\n        anchorLinkId: component.id,\n        inFocus: !!this.state.outlinedComponentId, __self: this, __source: { fileName: _jsxFileName, lineNumber: 339, columnNumber: 17 } }),\n\n\n      !!this.state.outlinedComponentId &&\n      ChartHolder.renderInFocusCSS(this.state.outlinedColumnName),\n      ___EmotionJSX(Chart, {\n        componentId: component.id,\n        id: component.meta.chartId,\n        dashboardId: dashboardId,\n        width: chartWidth,\n        height: chartHeight,\n        sliceName:\n        component.meta.sliceNameOverride ||\n        component.meta.sliceName ||\n        '',\n\n        updateSliceName: this.handleUpdateSliceName,\n        isComponentVisible: isComponentVisible,\n        handleToggleFullSize: this.handleToggleFullSize,\n        isFullSize: isFullSize, __self: this, __source: { fileName: _jsxFileName, lineNumber: 346, columnNumber: 15 } }),\n\n      editMode &&\n      ___EmotionJSX(HoverMenu, { position: \"top\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 363, columnNumber: 17 } },\n      ___EmotionJSX(\"div\", { \"data-test\": \"dashboard-delete-component-button\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 364, columnNumber: 19 } },\n      ___EmotionJSX(DeleteComponentButton, {\n        onDelete: this.handleDeleteComponent, __self: this, __source: { fileName: _jsxFileName, lineNumber: 365, columnNumber: 21 } })))),\n\n\n\n\n\n\n      dropIndicatorProps && ___EmotionJSX(\"div\", _extends({}, dropIndicatorProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 373, columnNumber: 36 } })))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChartHolder.propTypes = propTypes;\nChartHolder.defaultProps = defaultProps;const _default =\n\nChartHolder;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(CHART_MARGIN, \"CHART_MARGIN\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(selectFocusedFilterScope, \"selectFocusedFilterScope\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(FilterFocusHighlight, \"FilterFocusHighlight\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(ChartHolder, \"ChartHolder\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");reactHotLoader.register(_default, \"default\", \"/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/Users/frankhe/projects/superset/superset-frontend/src/dashboard/components/gridComponents/ChartHolder.jsx"],"names":["React","PropTypes","cx","useTheme","useSelector","getChartIdsInFilterScope","Chart","AnchorLink","DeleteComponentButton","DragDroppable","HoverMenu","ResizableContainer","getChartAndLabelComponentIdFromPath","componentShape","COLUMN_TYPE","ROW_TYPE","GRID_BASE_UNIT","GRID_GUTTER_SIZE","GRID_MIN_COLUMN_COUNT","GRID_MIN_ROW_UNITS","CHART_MARGIN","propTypes","id","string","isRequired","parentId","dashboardId","number","component","parentComponent","index","depth","editMode","bool","directPathToChild","arrayOf","directPathLastUpdated","focusedFilterScope","object","fullSizeChartId","oneOf","availableColumnCount","columnWidth","onResizeStart","func","onResize","onResizeStop","deleteComponent","updateComponents","handleComponentDrop","setFullSizeChartId","defaultProps","selectFocusedFilterScope","dashboardState","dashboardFilters","focusedFilterField","chartId","column","scope","scopes","FilterFocusHighlight","forwardRef","otherProps","ref","theme","nativeFilters","state","focusedNativeFilterId","focusedFilterId","unfocusedChartStyles","opacity","pointerEvents","focusedChartStyles","borderColor","colors","primary","light2","boxShadow","gridUnit","base","filters","chartsInScope","filterScope","ChartHolder","Component","renderInFocusCSS","columnName","getDerivedStateFromProps","props","label","chart","chartComponentId","outlinedComponentId","outlinedColumnName","constructor","isFocused","handleChangeFocus","handleDeleteComponent","handleUpdateSliceName","handleToggleFullSize","componentDidMount","hideOutline","componentDidUpdate","prevProps","prevState","timerKey","prevTimerKey","setState","nextFocus","nextName","meta","sliceNameOverride","isFullSize","render","isComponentVisible","widthMultiple","type","width","chartWidth","chartHeight","window","innerWidth","innerHeight","Math","floor","height","dropIndicatorProps","dragSourceRef","sliceName"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport cx from 'classnames';\nimport { useTheme } from '@superset-ui/core';\nimport { useSelector } from 'react-redux';\n\nimport { getChartIdsInFilterScope } from 'src/dashboard/util/activeDashboardFilters';\nimport Chart from '../../containers/Chart';\nimport AnchorLink from '../../../components/AnchorLink';\nimport DeleteComponentButton from '../DeleteComponentButton';\nimport DragDroppable from '../dnd/DragDroppable';\nimport HoverMenu from '../menu/HoverMenu';\nimport ResizableContainer from '../resizable/ResizableContainer';\nimport getChartAndLabelComponentIdFromPath from '../../util/getChartAndLabelComponentIdFromPath';\nimport { componentShape } from '../../util/propShapes';\nimport { COLUMN_TYPE, ROW_TYPE } from '../../util/componentTypes';\n\nimport {\n  GRID_BASE_UNIT,\n  GRID_GUTTER_SIZE,\n  GRID_MIN_COLUMN_COUNT,\n  GRID_MIN_ROW_UNITS,\n} from '../../util/constants';\n\nconst CHART_MARGIN = 32;\n\nconst propTypes = {\n  id: PropTypes.string.isRequired,\n  parentId: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  component: componentShape.isRequired,\n  parentComponent: componentShape.isRequired,\n  index: PropTypes.number.isRequired,\n  depth: PropTypes.number.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  directPathToChild: PropTypes.arrayOf(PropTypes.string),\n  directPathLastUpdated: PropTypes.number,\n  focusedFilterScope: PropTypes.object,\n  fullSizeChartId: PropTypes.oneOf([PropTypes.number, null]),\n\n  // grid related\n  availableColumnCount: PropTypes.number.isRequired,\n  columnWidth: PropTypes.number.isRequired,\n  onResizeStart: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  onResizeStop: PropTypes.func.isRequired,\n\n  // dnd\n  deleteComponent: PropTypes.func.isRequired,\n  updateComponents: PropTypes.func.isRequired,\n  handleComponentDrop: PropTypes.func.isRequired,\n  setFullSizeChartId: PropTypes.func.isRequired,\n};\n\nconst defaultProps = {\n  directPathToChild: [],\n  directPathLastUpdated: 0,\n};\n\n/**\n * Selects the chart scope of the filter input that has focus.\n *\n * @returns {{chartId: number, scope: { scope: string[], immune: string[] }} | null }\n * the scope of the currently focused filter, if any\n */\nfunction selectFocusedFilterScope(dashboardState, dashboardFilters) {\n  if (!dashboardState.focusedFilterField) return null;\n  const { chartId, column } = dashboardState.focusedFilterField;\n  return {\n    chartId,\n    scope: dashboardFilters[chartId].scopes[column],\n  };\n}\n\n/**\n * Renders any styles necessary to highlight the chart's relationship to the focused filter.\n *\n * If there is no focused filter scope (i.e. most of the time), this will be just a pass-through.\n *\n * If the chart is outside the scope of the focused filter, dims the chart.\n *\n * If the chart is in the scope of the focused filter,\n * renders a highlight around the chart.\n *\n * If ChartHolder were a function component, this could be implemented as a hook instead.\n */\nconst FilterFocusHighlight = React.forwardRef(\n  ({ chartId, ...otherProps }, ref) => {\n    const theme = useTheme();\n\n    const nativeFilters = useSelector(state => state.nativeFilters);\n    const dashboardState = useSelector(state => state.dashboardState);\n    const dashboardFilters = useSelector(state => state.dashboardFilters);\n    const focusedFilterScope = selectFocusedFilterScope(\n      dashboardState,\n      dashboardFilters,\n    );\n    const focusedNativeFilterId = nativeFilters.focusedFilterId;\n    if (!(focusedFilterScope || focusedNativeFilterId))\n      return <div ref={ref} {...otherProps} />;\n\n    // we use local styles here instead of a conditionally-applied class,\n    // because adding any conditional class to this container\n    // causes performance issues in Chrome.\n\n    // default to the \"de-emphasized\" state\n    const unfocusedChartStyles = { opacity: 0.3, pointerEvents: 'none' };\n    const focusedChartStyles = {\n      borderColor: theme.colors.primary.light2,\n      opacity: 1,\n      boxShadow: `0px 0px ${theme.gridUnit * 2}px ${theme.colors.primary.base}`,\n      pointerEvents: 'auto',\n    };\n\n    if (focusedNativeFilterId) {\n      if (\n        nativeFilters.filters[focusedNativeFilterId]?.chartsInScope?.includes(\n          chartId,\n        )\n      ) {\n        return <div ref={ref} style={focusedChartStyles} {...otherProps} />;\n      }\n    } else if (\n      chartId === focusedFilterScope.chartId ||\n      getChartIdsInFilterScope({\n        filterScope: focusedFilterScope.scope,\n      }).includes(chartId)\n    ) {\n      return <div ref={ref} style={focusedChartStyles} {...otherProps} />;\n    }\n\n    // inline styles are used here due to a performance issue when adding/changing a class, which causes a reflow\n    return <div ref={ref} style={unfocusedChartStyles} {...otherProps} />;\n  },\n);\n\nclass ChartHolder extends React.Component {\n  static renderInFocusCSS(columnName) {\n    return (\n      <style>\n        {`label[for=${columnName}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`}\n      </style>\n    );\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    const { component, directPathToChild, directPathLastUpdated } = props;\n    const {\n      label: columnName,\n      chart: chartComponentId,\n    } = getChartAndLabelComponentIdFromPath(directPathToChild);\n\n    if (\n      directPathLastUpdated !== state.directPathLastUpdated &&\n      component.id === chartComponentId\n    ) {\n      return {\n        outlinedComponentId: component.id,\n        outlinedColumnName: columnName,\n        directPathLastUpdated,\n      };\n    }\n    return null;\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isFocused: false,\n      outlinedComponentId: null,\n      outlinedColumnName: null,\n      directPathLastUpdated: 0,\n    };\n\n    this.handleChangeFocus = this.handleChangeFocus.bind(this);\n    this.handleDeleteComponent = this.handleDeleteComponent.bind(this);\n    this.handleUpdateSliceName = this.handleUpdateSliceName.bind(this);\n    this.handleToggleFullSize = this.handleToggleFullSize.bind(this);\n  }\n\n  componentDidMount() {\n    this.hideOutline({}, this.state);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.hideOutline(prevState, this.state);\n  }\n\n  hideOutline(prevState, state) {\n    const { outlinedComponentId: timerKey } = state;\n    const { outlinedComponentId: prevTimerKey } = prevState;\n\n    // because of timeout, there might be multiple charts showing outline\n    if (!!timerKey && !prevTimerKey) {\n      setTimeout(() => {\n        this.setState(() => ({\n          outlinedComponentId: null,\n          outlinedColumnName: null,\n        }));\n      }, 2000);\n    }\n  }\n\n  handleChangeFocus(nextFocus) {\n    this.setState(() => ({ isFocused: nextFocus }));\n  }\n\n  handleDeleteComponent() {\n    const { deleteComponent, id, parentId } = this.props;\n    deleteComponent(id, parentId);\n  }\n\n  handleUpdateSliceName(nextName) {\n    const { component, updateComponents } = this.props;\n    updateComponents({\n      [component.id]: {\n        ...component,\n        meta: {\n          ...component.meta,\n          sliceNameOverride: nextName,\n        },\n      },\n    });\n  }\n\n  handleToggleFullSize() {\n    const { component, fullSizeChartId, setFullSizeChartId } = this.props;\n    const { chartId } = component.meta;\n    const isFullSize = fullSizeChartId === chartId;\n    setFullSizeChartId(isFullSize ? null : chartId);\n  }\n\n  render() {\n    const { isFocused } = this.state;\n    const {\n      component,\n      parentComponent,\n      index,\n      depth,\n      availableColumnCount,\n      columnWidth,\n      onResizeStart,\n      onResize,\n      onResizeStop,\n      handleComponentDrop,\n      editMode,\n      isComponentVisible,\n      dashboardId,\n      fullSizeChartId,\n    } = this.props;\n\n    const { chartId } = component.meta;\n    const isFullSize = fullSizeChartId === chartId;\n\n    // inherit the size of parent columns\n    const widthMultiple =\n      parentComponent.type === COLUMN_TYPE\n        ? parentComponent.meta.width || GRID_MIN_COLUMN_COUNT\n        : component.meta.width || GRID_MIN_COLUMN_COUNT;\n\n    let chartWidth = 0;\n    let chartHeight = 0;\n\n    if (isFullSize) {\n      chartWidth = window.innerWidth - CHART_MARGIN;\n      chartHeight = window.innerHeight - CHART_MARGIN;\n    } else {\n      chartWidth = Math.floor(\n        widthMultiple * columnWidth +\n          (widthMultiple - 1) * GRID_GUTTER_SIZE -\n          CHART_MARGIN,\n      );\n      chartHeight = Math.floor(\n        component.meta.height * GRID_BASE_UNIT - CHART_MARGIN,\n      );\n    }\n\n    return (\n      <DragDroppable\n        component={component}\n        parentComponent={parentComponent}\n        orientation={parentComponent.type === ROW_TYPE ? 'column' : 'row'}\n        index={index}\n        depth={depth}\n        onDrop={handleComponentDrop}\n        disableDragDrop={isFocused}\n        editMode={editMode}\n      >\n        {({ dropIndicatorProps, dragSourceRef }) => (\n          <ResizableContainer\n            id={component.id}\n            adjustableWidth={parentComponent.type === ROW_TYPE}\n            adjustableHeight\n            widthStep={columnWidth}\n            widthMultiple={widthMultiple}\n            heightStep={GRID_BASE_UNIT}\n            heightMultiple={component.meta.height}\n            minWidthMultiple={GRID_MIN_COLUMN_COUNT}\n            minHeightMultiple={GRID_MIN_ROW_UNITS}\n            maxWidthMultiple={availableColumnCount + widthMultiple}\n            onResizeStart={onResizeStart}\n            onResize={onResize}\n            onResizeStop={onResizeStop}\n            editMode={editMode}\n          >\n            <FilterFocusHighlight\n              chartId={chartId}\n              ref={dragSourceRef}\n              data-test=\"dashboard-component-chart-holder\"\n              className={cx(\n                'dashboard-component',\n                'dashboard-component-chart-holder',\n                this.state.outlinedComponentId ? 'fade-in' : 'fade-out',\n                isFullSize && 'full-size',\n              )}\n            >\n              {!editMode && (\n                <AnchorLink\n                  anchorLinkId={component.id}\n                  inFocus={!!this.state.outlinedComponentId}\n                />\n              )}\n              {!!this.state.outlinedComponentId &&\n                ChartHolder.renderInFocusCSS(this.state.outlinedColumnName)}\n              <Chart\n                componentId={component.id}\n                id={component.meta.chartId}\n                dashboardId={dashboardId}\n                width={chartWidth}\n                height={chartHeight}\n                sliceName={\n                  component.meta.sliceNameOverride ||\n                  component.meta.sliceName ||\n                  ''\n                }\n                updateSliceName={this.handleUpdateSliceName}\n                isComponentVisible={isComponentVisible}\n                handleToggleFullSize={this.handleToggleFullSize}\n                isFullSize={isFullSize}\n              />\n              {editMode && (\n                <HoverMenu position=\"top\">\n                  <div data-test=\"dashboard-delete-component-button\">\n                    <DeleteComponentButton\n                      onDelete={this.handleDeleteComponent}\n                    />\n                  </div>\n                </HoverMenu>\n              )}\n            </FilterFocusHighlight>\n\n            {dropIndicatorProps && <div {...dropIndicatorProps} />}\n          </ResizableContainer>\n        )}\n      </DragDroppable>\n    );\n  }\n}\n\nChartHolder.propTypes = propTypes;\nChartHolder.defaultProps = defaultProps;\n\nexport default ChartHolder;\n"]},"metadata":{},"sourceType":"module"}